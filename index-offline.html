<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Phosphor-95 - Fantasy OS</title>
  <style>
    @font-face {
      font-family: 'Indie Flower';
      src: url('fonts/IndieFlower.woff2') format('woff2');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }
  </style>
  <style>
    :root{
      --bg:#00160f;           /* deep green-black */
      --grid:#002117;         /* darker grid */
      --hi:#7aff7a;           /* phosphor green */
      --med:#3bd13b;          /* mid green */
      --low:#1f6c1f;          /* low green */
      --line:#0b3a0b;         /* outline */
      --glass:#0d241a;        /* inner bezel */
      --shadow:#000000;
      --scan-opa:.12;         /* scanline intensity */
      --flicker:.04;          /* flicker amplitude */
      --bezel-radius:18px;
      --chrome:#0b2a20;       /* outer bezel */
      --beige-1:#e6dfcf;      /* monitor plastic light */
      --beige-2:#d2c8b4;      /* monitor plastic mid */
      --beige-3:#b8ae99;      /* monitor plastic dark */
      --beige-line:#9c927e;   /* monitor plastic outline */
      --led-on:#70ff70;       /* power LED on */
      --led-off:#a88b2a;      /* power LED off/amber */
      --z-start:10;
    }

    html,body{
      height:100%;
      margin:0;
      background: radial-gradient(circle at 50% 46%, #0a110e 0 40%, #050806 75%, #000 100%);
      color:var(--hi);
      font: 14px/1.3 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      letter-spacing:.2px;
      overflow:hidden;
    }

    /* Monitor chassis (beige) */
    .monitor{
      position:fixed; inset:0; margin:auto; border-radius: 22px;
      width: min(94vw, calc(94vh * 4 / 3));
      aspect-ratio: 4 / 3;
      background: linear-gradient(180deg, var(--beige-1), var(--beige-2));
      box-shadow:
        0 50px 120px rgba(0,0,0,.6),
        inset 0 2px 0 rgba(255,255,255,.5),
        inset 0 -3px 12px rgba(0,0,0,.15);
      border:1px solid var(--beige-line);
      padding: 22px 22px 72px 22px; /* leave space for bottom panel */
      display:grid; grid-template-rows: 1fr auto; grid-template-columns: 1fr;
    }

    .monitor-bottom{
      height:58px; margin-top:14px; border-radius: 12px;
      background: linear-gradient(#e9e2d4, #d9d0bd);
      border:1px solid var(--beige-line);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.7), inset 0 -2px 6px rgba(0,0,0,.15);
      display:flex; align-items:center; justify-content:space-between; padding: 0 16px;
      color:#4d4a42;
    }
    .brand{ font-weight:bold; letter-spacing:1px; }
    .power{
      display:flex; align-items:center; gap:10px;
    }
    .led{
      width:12px; height:8px; border-radius:2px; border:1px solid #4d4a42;
      background: var(--led-on); box-shadow: 0 0 8px rgba(112,255,112,.8);
      transition: background .2s, box-shadow .2s;
    }
    .monitor.off .led{ background: var(--led-off); box-shadow: 0 0 4px rgba(168,139,42,.6); }
    .pwrbtn{
      width:52px; height:18px; border-radius:3px; border:1px solid #6e685c;
      background: linear-gradient(#cfc7b3, #bdb39e);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.7), inset 0 -2px 0 rgba(0,0,0,.12);
      cursor:pointer;
    }
    /* Off state: make screen black but keep reflection visible */
    .monitor.off .glass{ background:#000 !important; filter:none; }
    .monitor.off .glass::before,
    .monitor.off .glass::after{ opacity:0; }
    .monitor.off .screen{ opacity:0; transform: scaleY(0); }

    /* CRT bezel */
    .bezel{
      position:relative; border-radius: calc(var(--bezel-radius) * 1.3);
      background: 
        linear-gradient(#0a1f19, #071611);
      box-shadow:
        0 0 0 10px var(--chrome),
        0 0 0 14px #06110d,
        0 40px 80px rgba(0,0,0,.7),
        inset 0 2px 0 rgba(255,255,255,.03),
        inset 0 -3px 8px rgba(0,0,0,.6);
      display:grid; place-items:center;
    }

    /* The glass with slight curvature */
    .glass{
      position:relative; width:100%; height:100%;
      margin:20px; border-radius: var(--bezel-radius);
      background: radial-gradient(120% 100% at 50% 40%, #062017 0%, #051a13 55%, #04140f 70%, #03100c 100%);
      box-shadow:
        inset 0 0 120px rgba(0,0,0,.55),
        inset 0 0 12px rgba(0,0,0,.9),
        inset 0 60px 120px rgba(0,0,0,.35);
      overflow:hidden;
    }

    /* Scanlines and vignette */
    .glass::before{
      content:''; position:absolute; inset:0;
      background: repeating-linear-gradient(
        to bottom,
        rgba(122,255,122,var(--scan-opa)) 0px,
        rgba(122,255,122,0) 2px,
        rgba(0,0,0,0) 3px,
        rgba(0,0,0,.02) 4px
      );
      mix-blend-mode: overlay;
      pointer-events:none;
      animation: flicker 4.2s infinite steps(60);
    }
    .glass::after{
      content:''; position:absolute; inset:0;
      background:
        radial-gradient(ellipse at 50% -10%, rgba(255,255,255,.08), transparent 35%),
        radial-gradient(circle at 50% 50%, rgba(0,0,0,0) 60%, rgba(0,0,0,.45) 95%);
      pointer-events:none;
    }

    @keyframes flicker{
      0%,100%{ opacity:1 }
      10%{ opacity: calc(1 - var(--flicker)) }
      11%{ opacity:1 }
      50%{ opacity: calc(1 - var(--flicker) * .8) }
      51%{ opacity:1 }
      75%{ opacity: calc(1 - var(--flicker) * .6) }
    }

    /* Pixel grid subtle texture */
    .noise{
      position:absolute; inset:0; pointer-events:none;
      background:
        repeating-linear-gradient(90deg, rgba(122,255,122,.03) 0 1px, rgba(0,0,0,0) 1px 2px),
        repeating-linear-gradient(0deg, rgba(122,255,122,.02) 0 1px, rgba(0,0,0,0) 1px 2px);
      mix-blend-mode: soft-light;
      opacity:.5;
    }

    /* Screen container for power animations */
    .screen{ position:relative; width:100%; height:100%; transform-origin:50% 50%; }
    .screen.off-anim{ animation: powerOff 650ms ease-in forwards; }
    .screen.on-anim{ animation: powerOn 700ms ease-out forwards; }

    @keyframes powerOff{
      0%{ transform: scaleY(1); opacity:1; }
      70%{ transform: scaleY(.04); opacity:1; filter:brightness(1.2); }
      100%{ transform: scaleY(0); opacity:0; }
    }
    @keyframes powerOn{
      0%{ transform: scaleY(0); opacity:0; }
      30%{ transform: scaleY(.04); opacity:.9; filter:brightness(1.2); }
      100%{ transform: scaleY(1); opacity:1; filter:none; }
    }

    /* Reflection video overlay */
    .reflection{
      position:absolute; inset:0; pointer-events:none; z-index:2;
      width:100%; height:100%; object-fit:cover; object-position:center top;
      opacity:.12; mix-blend-mode:screen; filter:brightness(.3) contrast(.9) saturate(.7);
      transform: scale(1.18); /* slight crop */
    }
    .monitor.booting .reflection{ opacity:.22; filter:brightness(.45) contrast(.95) saturate(.85); }
    .monitor.off .reflection{ opacity:.18; filter:brightness(.45) contrast(.95) saturate(.85); }

    /* Power hint */
    .power-hint{ position:absolute; right:84px; bottom:94px; pointer-events:none; display:flex; align-items:center; gap:10px; z-index:3; }
    .hint-text{ color:#7affff; text-shadow: 0 0 8px rgba(122,255,255,.6), 0 0 18px rgba(122,255,255,.25); font-weight:bold; letter-spacing:1px; animation: pulse 1.6s ease-in-out infinite; }
    .hint-arrow{ width:0; height:0; border-top:6px solid transparent; border-bottom:6px solid transparent; border-left:12px solid #ff6bd6; filter: drop-shadow(0 0 6px rgba(255,107,214,.8)); transform: translateX(0); animation: nudge 1s ease-in-out infinite; }
    @keyframes pulse{ 0%,100%{ opacity:1 } 50%{ opacity:.55 } }
    @keyframes nudge{ 0%,100%{ transform:translateX(0) } 50%{ transform:translateX(4px) } }

    /* Boot overlay */
    .boot{ position:absolute; inset:18px 18px 54px 18px; background:transparent; color:var(--hi); border:1px solid var(--line); box-shadow: inset 0 0 0 1px #0c3b1a; z-index:3; display:none; }
    .boot::before{ content:''; position:absolute; inset:0; background: rgba(0,0,0,.45); mix-blend-mode: multiply; pointer-events:none; }
    .monitor.booting .reflection{ opacity:.20; }
    .boot.show{ display:block; }
    .boot pre{ margin:8px; font: inherit; color:var(--hi); text-shadow: 0 0 6px rgba(122,255,122,.22); font-variant-ligatures: none; font-feature-settings: "liga" 0; white-space: pre; line-height:1.15; }
    .boot .cursor{ display:inline-block; width:8px; background:var(--hi); animation: blink 1s steps(1) infinite; }
    @keyframes blink{ 0%,49%{ opacity:1 } 50%,100%{ opacity:0 } }

    /* Vector draw reveal */
    .monitor.vector-hide .desktop,
    .monitor.vector-hide .taskbar,
    .monitor.vector-hide .menu,
    .monitor.vector-hide .icon,
    .monitor.vector-hide .win{ opacity:0; }
    .line-draw{ transition: opacity .35s ease, border-color .35s ease, box-shadow .35s ease; }

    /* Desktop */
    .desktop{
      position:absolute; inset:18px 18px 54px 18px; /* leave room for taskbar */
      background:
        linear-gradient(#03140e, #03140e),
        repeating-linear-gradient(0deg, var(--grid) 0 2px, transparent 2px 20px),
        repeating-linear-gradient(90deg, var(--grid) 0 2px, transparent 2px 20px);
      background-blend-mode: normal, lighten, lighten;
      border:1px solid var(--line);
      box-shadow: inset 0 0 0 1px #052016;
      overflow:hidden;
    }

    /* Taskbar */
    .taskbar{
      position:absolute; left:18px; right:18px; bottom:18px; height:36px;
      background: linear-gradient(#062117, #041b13);
      border:1px solid var(--line);
      box-shadow: inset 0 0 0 1px #0b3a0b, 0 -1px 0 #0a2f0a;
      display:flex; align-items:center; gap:8px; padding:4px 6px;
    }
    .start{
      height:28px; min-width:80px; padding:0 10px;
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--line); box-shadow: inset 0 0 0 1px #145414;
      background: linear-gradient(#083719, #062e16);
      color:var(--hi); cursor:pointer; user-select:none;
    }
    .start:active{ filter:brightness(.9); }

    .tasks{ flex:1; display:flex; gap:6px; overflow:hidden; }
    .task{
      min-width:120px; max-width:220px; height:28px; padding:0 8px; overflow:hidden;
      border:1px solid var(--line); box-shadow: inset 0 0 0 1px #0c3b0c;
      background: linear-gradient(#072d18, #062615);
      display:flex; align-items:center; color:var(--med);
      white-space:nowrap; text-overflow:ellipsis; cursor:pointer;
    }
    .task.active{ background: linear-gradient(#0b3b1f, #083219); color:var(--hi); }

    .clock{ min-width:90px; text-align:center; color:var(--med); }
    
    .climate{ 
      display:flex; gap:10px; padding:0 10px; color:var(--med); font-size:13px;
      border-left:1px solid var(--line); 
    }
    .climate-item{ display:flex; align-items:center; gap:4px; }
    .climate-value{ color:var(--hi); }
    
    /* Photo Gallery Styles */
    .gallery-grid{
      display:grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap:8px; padding:8px; max-height:340px; overflow-y:auto;
    }
    .gallery-thumb{
      aspect-ratio:1; border:1px solid var(--line); cursor:pointer;
      background-size:cover; background-position:center;
      box-shadow: inset 0 0 0 1px #0c3b0c;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .gallery-thumb:hover{
      border-color:var(--hi); box-shadow: inset 0 0 0 1px var(--hi), 0 0 8px rgba(122,255,122,.15);
    }
    .photo-viewer{
      display:flex; gap:12px; height:100%;
    }
    .photo-main{
      flex:1; display:flex; flex-direction:column; gap:8px;
    }
    .photo-img{
      flex:1; border:1px solid var(--line); background-size:contain; background-repeat:no-repeat; background-position:center;
      background-color:#041810; box-shadow: inset 0 0 0 1px #0c3b0c;
    }
    .photo-nav{
      display:flex; gap:6px; justify-content:center;
    }
    .photo-nav button{
      padding:6px 14px; border:1px solid var(--line); background:linear-gradient(#083719, #062e16);
      color:var(--hi); cursor:pointer; font:inherit; box-shadow: inset 0 0 0 1px #145414;
    }
    .photo-nav button:hover{ filter:brightness(1.1); }
    .photo-nav button:active{ transform:translateY(1px); }
    .photo-notes{
      width:220px; padding:10px; border:1px solid var(--line); background:#061810;
      overflow-y:auto; color:var(--med); line-height:1.5; font-size:13px;
    }
    .photo-notes h3{ color:var(--hi); margin:0 0 8px 0; font-size:14px; }
    
    /* Sticky Note */
    .sticky-note{
      position:absolute; top:-45px; right:24px; width:180px; 
      background:linear-gradient(135deg, #ffd97d 0%, #ffe89f 100%);
      padding:16px 14px 20px; box-shadow:2px 4px 12px rgba(0,0,0,.35);
      font-family:'Indie Flower', cursive; 
      font-size:16px; line-height:1.7; color:#1a1a1a;
      transform:rotate(2.5deg); border-radius:2px;
      border-bottom:20px solid rgba(0,0,0,.05);
      z-index:9999;
      letter-spacing:0.3px;
    }
    .sticky-note::before{
      content:''; position:absolute; top:-8px; right:15px; 
      width:40px; height:20px; background:rgba(255,255,255,.3);
      transform:rotate(-5deg); border-radius:50%;
    }
    .sticky-note div{
      transform:rotate(-0.5deg);
    }
    .sticky-note div:nth-child(2){ transform:rotate(0.3deg); }
    .sticky-note div:nth-child(3){ transform:rotate(-0.2deg); }
    .sticky-note div:nth-child(4){ transform:rotate(0.4deg); }
    
    /* Email Client Styles */
    .email-layout{
      display:flex; height:100%; gap:1px; background:var(--line);
    }
    .email-folders{
      width:120px; background:#061810; padding:6px;
    }
    .email-folder{
      padding:8px; margin-bottom:2px; border:1px solid transparent;
      cursor:pointer; color:var(--med); font-size:13px;
    }
    .email-folder:hover{ background:#072114; border-color:#0e3a1e; }
    .email-folder.active{ background:#083719; border-color:var(--hi); color:var(--hi); }
    .email-folder-count{ 
      float:right; font-size:11px; color:#6b6;
    }
    .email-list{
      width:280px; background:#061810; overflow-y:auto; padding:4px;
    }
    .email-item{
      padding:8px; margin-bottom:2px; border:1px solid transparent;
      cursor:pointer; color:var(--med); font-size:13px; line-height:1.4;
    }
    .email-item:hover{ background:#072114; border-color:#0e3a1e; }
    .email-item.unread{ color:var(--hi); font-weight:bold; }
    .email-item.unread::before{ content:'● '; color:#6b6; }
    .email-from{ color:var(--hi); font-size:12px; margin-bottom:2px; }
    .email-subject{ margin-bottom:2px; }
    .email-date{ color:#6b6; font-size:11px; }
    .email-preview{ 
      flex:1; background:#061810; padding:12px; overflow-y:auto;
      color:var(--med); line-height:1.6;
    }
    .email-header{ 
      padding-bottom:10px; margin-bottom:10px; 
      border-bottom:1px solid var(--line);
    }
    .email-header div{ margin-bottom:4px; }
    .email-body{ white-space:pre-wrap; }

    /* Start menu */
    .menu{
      position:absolute; bottom:56px; left:26px; width:260px;
      border:1px solid var(--line); box-shadow: 0 8px 34px rgba(0,0,0,.5), inset 0 0 0 1px #0b3816;
      background: linear-gradient(#061f14, #051b12);
      display:none; flex-direction:column; padding:6px;
      z-index: calc(var(--z-start) + 1000);
    }
    .menu.open{ display:flex; }
    .menu .item{ padding:6px 8px; color:var(--med); cursor:pointer; border:1px solid transparent; }
    .menu .item:hover{ color:var(--hi); background:#072114; border-color:#0e3a1e; }

    /* Windows */
    .win{
      position:absolute; top:60px; left:60px; width:520px; min-width:280px; max-width:80vw; min-height:180px;
      border:1px solid var(--line);
      box-shadow: 0 10px 30px rgba(0,0,0,.6), inset 0 0 0 1px #0c3b1a;
      background: linear-gradient(#071c13, #06180f);
      display:flex; flex-direction:column;
    }
    .win.inactive{ opacity:.8; }

    .titlebar{
      height:28px; display:flex; align-items:center; gap:8px; padding:0 8px;
      background: linear-gradient(#0b3b1f, #0a341b);
      border-bottom:1px solid var(--line);
      color:var(--hi); cursor:move; user-select:none;
    }
    .titlebar .title{ flex:1; }
    .titlebar .btns{ display:flex; gap:6px; }
    .btn{
      width:22px; height:18px; display:grid; place-items:center;
      border:1px solid var(--line); box-shadow: inset 0 0 0 1px #125a2b;
      background: linear-gradient(#09361d, #082f19); color:var(--med);
      font-weight:bold; cursor:pointer; user-select:none;
    }
    .btn:active{ transform: translateY(1px); }

    .menubar{
      height:22px; display:flex; gap:8px; align-items:center; padding:0 8px;
      color:var(--med); border-bottom:1px solid var(--line);
      background: linear-gradient(#061b12, #05180f);
    }
    .menubar .mitem{ padding:2px 6px; cursor:pointer; border:1px solid transparent; }
    .menubar .mitem:hover{ color:var(--hi); background:#072114; border-color:#0e3a1e; }

    .content{ flex:1; padding:8px; color:var(--med); overflow:auto; }

    /* Desktop icon */
    .icon{
      position:absolute; top:24px; left:24px; width:84px;
      display:flex; flex-direction:column; align-items:center; gap:6px;
      color:var(--med); cursor:default; user-select:none;
    }
    .icon .glyph{ width:38px; height:28px; border:1px solid var(--line); box-shadow: inset 0 0 0 1px #0c3b0c; background:linear-gradient(#083719, #062e16); }
    .icon .label{ text-align:center; font-size:12px; line-height:1.2; }

    /* Bloom glow for text */
    .bloom{ text-shadow: 0 0 6px rgba(122,255,122,.22), 0 0 14px rgba(122,255,122,.08); }

    /* Window resizers */
    .resizer{ position:absolute; z-index:5; }
    .resizer.n{ top:-3px; left:6px; right:6px; height:6px; cursor:n-resize; }
    .resizer.s{ bottom:-3px; left:6px; right:6px; height:6px; cursor:s-resize; }
    .resizer.e{ top:6px; bottom:6px; right:-3px; width:6px; cursor:e-resize; }
    .resizer.w{ top:6px; bottom:6px; left:-3px; width:6px; cursor:w-resize; }
    .resizer.ne{ top:-3px; right:-3px; width:10px; height:10px; cursor:ne-resize; }
    .resizer.nw{ top:-3px; left:-3px; width:10px; height:10px; cursor:nw-resize; }
    .resizer.se{ bottom:-3px; right:-3px; width:10px; height:10px; cursor:se-resize; }
    .resizer.sw{ bottom:-3px; left:-3px; width:10px; height:10px; cursor:sw-resize; }
    .win{ box-sizing:border-box; }

    /* Themed scrollbars */
    .content, textarea{
      scrollbar-width: thin;
      scrollbar-color: var(--med) #06180f;
    }
    .content::-webkit-scrollbar, textarea::-webkit-scrollbar{ width:10px; height:10px; }
    .content::-webkit-scrollbar-track, textarea::-webkit-scrollbar-track{ background:#06180f; border-left:1px solid var(--line); }
    .content::-webkit-scrollbar-thumb, textarea::-webkit-scrollbar-thumb{
      background: linear-gradient(#0b3b1f, #083219);
      border:1px solid var(--line);
      box-shadow: inset 0 0 0 1px #0c3b1a;
    }
    .content::-webkit-scrollbar-corner{ background:#06180f; }
  </style>
</head>
<body>
  <div class="monitor off" id="monitor">
    <div class="bezel">
      <div class="glass">
        <video class="reflection" src="video/reflection.mp4" autoplay loop muted playsinline></video>
        <div class="screen" id="screen">
          <div class="desktop" id="desktop">
          <div class="icon" tabindex="0" role="button" id="openAbout">
            <div class="glyph" aria-hidden="true"></div>
            <div class="label bloom">About.txt</div>
          </div>
          
          <div class="icon" style="top:24px; left:118px;" tabindex="0" role="button" id="plantNotesIcon">
            <div class="glyph" aria-hidden="true" style="display:grid; place-items:center; font-size:20px;">🌿</div>
            <div class="label bloom">Plant_Notes</div>
          </div>
          
          <div class="icon" style="top:120px; left:24px;" tabindex="0" role="button" id="waterLogIcon">
            <div class="glyph" aria-hidden="true" style="display:grid; place-items:center; font-size:20px;">💧</div>
            <div class="label bloom">Water_Log</div>
          </div>
          
          <div class="icon" style="top:120px; left:118px;" tabindex="0" role="button" id="greenhouseIcon">
            <div class="glyph" aria-hidden="true" style="display:grid; place-items:center; font-size:20px;">🏡</div>
            <div class="label bloom">Greenhouse</div>
          </div>
          
          <div class="icon" style="top:24px; left:212px;" tabindex="0" role="button" id="photoGalleryIcon">
            <div class="glyph" aria-hidden="true" style="display:grid; place-items:center; font-size:20px;">📷</div>
            <div class="label bloom">Photo_Log</div>
          </div>
          
          <div class="icon" style="top:120px; left:212px;" tabindex="0" role="button" id="emailIcon">
            <div class="glyph" aria-hidden="true" style="display:grid; place-items:center; font-size:20px;">📧</div>
            <div class="label bloom">E-Mail</div>
          </div>

          <div class="win" id="win-about" data-start-minimized style="top:92px;left:120px;z-index:11;">
            <div class="resizer n"></div>
            <div class="resizer s"></div>
            <div class="resizer e"></div>
            <div class="resizer w"></div>
            <div class="resizer ne"></div>
            <div class="resizer nw"></div>
            <div class="resizer se"></div>
            <div class="resizer sw"></div>
            <div class="titlebar" data-drag-handle>
              <div class="title bloom">ABOUT.TXT</div>
              <div class="btns">
                <div class="btn" data-minimize title="Minimize">_</div>
                <div class="btn" data-close title="Close">X</div>
              </div>
            </div>
            <div class="menubar">
              <div class="mitem">File</div>
              <div class="mitem">Edit</div>
              <div class="mitem">View</div>
              <div class="mitem">Help</div>
            </div>
            <div class="content">
              <pre class="bloom" style="margin:0;">
PHOSPHOR-95 MONO TUI
(c) 1995–2001 Retrotronics, Inc.

Welcome to your fantasy OS.
- Drag windows by the title bar.
- Use the Start button for apps.
- Click taskbar buttons to focus windows.
- Minimize with the _ button; close with X.

This UI blends Win95 layout with a low-res
monochrome CRT vibe: scanlines, vignette,
faint bloom, and phosphor green.

Climate monitoring keeps the arboretum
in perfect balance. 🌿
              </pre>
            </div>
          </div>
        </div>

        <div class="taskbar" id="taskbar">
          <div class="start" id="startBtn"><span class="bloom">START</span></div>
          <div class="tasks" id="tasks"></div>
          <div class="climate bloom" id="climate">
            <div class="climate-item">
              <span>💧</span>
              <span class="climate-value" id="humidity">--</span>
            </div>
            <div class="climate-item">
              <span>🌡️</span>
              <span class="climate-value" id="temp">--</span>
            </div>
            <div class="climate-item">
              <span>☀️</span>
              <span class="climate-value" id="light">--</span>
            </div>
          </div>
          <div class="clock bloom" id="clock">--:--</div>
        </div>

        <div class="menu" id="startMenu" role="menu" aria-label="Start Menu">
          <div class="item" data-launch="email">📧 E-Mail</div>
          <div class="item" data-launch="notepad">📝 Notepad</div>
          <div class="item" data-launch="files">📁 File Manager</div>
          <div class="item" data-launch="terminal">💻 Terminal</div>
          <div class="item" data-launch="greenhouse">🌿 Greenhouse Monitor</div>
          <div class="item" data-launch="photolog">📷 Photo Log</div>
          <div class="item" data-launch="forest">🌲 Forest Adventure</div>
          <div class="item" data-launch="dungeon">⚔️ Dungeon</div>
          <div class="item" data-launch="regedit">🔧 Registry Editor</div>
          <div class="item" data-launch="about">ℹ️ About</div>
        </div>

        <div class="noise"></div>
        </div><!-- /.screen -->
        
        <div class="sticky-note">
          <div style="margin-bottom:7px; font-weight:bold; text-decoration:underline;">Remember!!</div>
          <div style="margin-bottom:5px;">✓ Pearl Bells - mist 2x daily</div>
          <div style="margin-bottom:5px;">✓ Dr. Y visiting Thurs!!</div>
          <div style="margin-bottom:5px;">✓ Check Dragon Scale buds</div>
          <div style="margin-top:9px; font-style:italic; font-size:14px;">~the plants are counting on me~</div>
        </div>
      </div>
    </div>
    <div class="monitor-bottom">
      <div class="brand">PHOSPHOR-95</div>
      <div class="power">
        <div class="led" id="powerLed"></div>
        <button class="pwrbtn" id="powerBtn" aria-pressed="false" aria-label="Power"></button>
      </div>
    </div>
    <div class="power-hint" id="powerHint" aria-hidden="true">
      <div class="hint-text bloom">Click to power on</div>
      <div class="hint-arrow"></div>
    </div>
  </div>

  <script>
    (()=>{
      const desktop = document.getElementById('desktop');
      const taskbar = document.getElementById('taskbar');
      const tasks = document.getElementById('tasks');
      const clock = document.getElementById('clock');
      const startBtn = document.getElementById('startBtn');
      const startMenu = document.getElementById('startMenu');
      const aboutIcon = document.getElementById('openAbout');
      const monitor = document.getElementById('monitor');
      const screenEl = document.getElementById('screen');
      const powerBtn = document.getElementById('powerBtn');
      const powerLed = document.getElementById('powerLed');
      const powerHint = document.getElementById('powerHint');

      // Basic clock
      const fmt = (n)=> n<10? '0'+n : ''+n;
      function tick(){ const d=new Date(); clock.textContent = fmt(d.getHours())+':'+fmt(d.getMinutes()); }
      tick(); setInterval(tick, 10000);

      // Climate monitoring for plants
      const humidityEl = document.getElementById('humidity');
      const tempEl = document.getElementById('temp');
      const lightEl = document.getElementById('light');
      
      let baseHumidity = 62; // ideal range 60-65%
      let baseTemp = 21.5; // ideal range 20-24°C
      let baseLight = 450; // lux
      
      function updateClimate(){
        // Subtle variations over time
        const hour = new Date().getHours();
        // Humidity fluctuates slightly
        const humidity = baseHumidity + Math.sin(Date.now() / 180000) * 2.5 + (Math.random() - 0.5) * 0.8;
        // Temperature varies with time of day
        const tempVariation = Math.sin((hour - 6) / 24 * Math.PI * 2) * 1.5;
        const temp = baseTemp + tempVariation + (Math.random() - 0.5) * 0.3;
        // Light varies dramatically by hour (grow lights + natural)
        let light = hour >= 6 && hour <= 20 ? baseLight + (Math.random() * 50) : Math.random() * 15;
        if(hour >= 7 && hour <= 19) light += 200; // peak daylight hours
        
        humidityEl.textContent = humidity.toFixed(1) + '%';
        tempEl.textContent = temp.toFixed(1) + '°C';
        lightEl.textContent = Math.round(light) + 'lx';
      }
      updateClimate();
      setInterval(updateClimate, 8000);

      // Window manager
      let z=20; // z-index cursor
      const windows = new Map(); // id -> {el, task}

      function makeTaskButton(winEl){
        const id = winEl.id;
        const btn = document.createElement('div');
        btn.className = 'task';
        btn.textContent = winEl.querySelector('.title').textContent;
        btn.dataset.window=id;
        btn.addEventListener('click', ()=> focusWindow(id,true));
        tasks.appendChild(btn);
        return btn;
      }

      // === POWER BUTTON SOUNDS ===
      
      function playPowerOnWhine(){ 
        if(!audio.ctx || !audio.noise) return; 
        const ctx = audio.ctx; 
        const now = ctx.currentTime;
        
        // CRT degauss coil activation (magnetic THUNK)
        const degaussThunk = ctx.createOscillator();
        degaussThunk.type = 'sine';
        degaussThunk.frequency.setValueAtTime(35, now);
        degaussThunk.frequency.exponentialRampToValueAtTime(22, now + 0.08);
        
        const thunkGain = ctx.createGain();
        thunkGain.gain.setValueAtTime(0.0, now);
        thunkGain.gain.linearRampToValueAtTime(0.28, now + 0.01);
        thunkGain.gain.exponentialRampToValueAtTime(0.001, now + 0.12);
        
        degaussThunk.connect(thunkGain);
        thunkGain.connect(audio.master);
        degaussThunk.start();
        
        // Transformer/PSU rising whine
        const powerWhine = ctx.createOscillator();
        powerWhine.type = 'sawtooth';
        powerWhine.frequency.setValueAtTime(180, now + 0.05);
        powerWhine.frequency.exponentialRampToValueAtTime(1600, now + 0.55);
        
        const whineLP = ctx.createBiquadFilter();
        whineLP.type = 'lowpass';
        whineLP.frequency.setValueAtTime(800, now + 0.05);
        whineLP.frequency.exponentialRampToValueAtTime(2400, now + 0.5);
        
        const whineGain = ctx.createGain();
        whineGain.gain.setValueAtTime(0.0, now + 0.05);
        whineGain.gain.linearRampToValueAtTime(0.15, now + 0.15);
        whineGain.gain.exponentialRampToValueAtTime(0.001, now + 0.62);
        
        powerWhine.connect(whineLP);
        whineLP.connect(whineGain);
        whineGain.connect(audio.master);
        powerWhine.start();
        
        // Relay clicks and capacitor charging thumps
        const relayClicks = [0.12, 0.24, 0.38];
        relayClicks.forEach(delay => {
          setTimeout(() => {
            const t = ctx.currentTime;
            const clickBP = ctx.createBiquadFilter();
            clickBP.type = 'bandpass';
            clickBP.frequency.value = 400 + Math.random() * 300;
            clickBP.Q.value = 4.0;
            
            const clickGain = ctx.createGain();
            clickGain.gain.setValueAtTime(0.0, t);
            clickGain.gain.linearRampToValueAtTime(0.1, t + 0.005);
            clickGain.gain.exponentialRampToValueAtTime(0.001, t + 0.04);
            
            audio.noise.connect(clickBP);
            clickBP.connect(clickGain);
            clickGain.connect(audio.master);
            
            setTimeout(() => {
              clickGain.disconnect();
              clickBP.disconnect();
            }, 80);
          }, delay * 1000);
        });
        
        // HDD spin-up (higher frequency mechanical whir)
        setTimeout(() => {
          const t = ctx.currentTime;
          
          // Use noise-based spin-up instead of low oscillator
          const spinBP = ctx.createBiquadFilter();
          spinBP.type = 'bandpass';
          spinBP.frequency.setValueAtTime(180, t);
          spinBP.frequency.exponentialRampToValueAtTime(420, t + 0.7);
          spinBP.Q.value = 2.8;
          
          const spinLP = ctx.createBiquadFilter();
          spinLP.type = 'lowpass';
          spinLP.frequency.value = 600;
          
          const spinGain = ctx.createGain();
          spinGain.gain.setValueAtTime(0.0, t);
          spinGain.gain.linearRampToValueAtTime(0.045, t + 0.12);
          spinGain.gain.setValueAtTime(0.045, t + 0.6);
          spinGain.gain.exponentialRampToValueAtTime(0.001, t + 0.85);
          
          audio.noise.connect(spinBP);
          spinBP.connect(spinLP);
          spinLP.connect(spinGain);
          spinGain.connect(audio.master);
          
          setTimeout(() => {
            spinGain.disconnect();
            spinLP.disconnect();
            spinBP.disconnect();
          }, 950);
        }, 350);
        
        setTimeout(() => {
          try { degaussThunk.stop(); } catch {}
          try { powerWhine.stop(); } catch {}
          thunkGain.disconnect();
          whineGain.disconnect();
          whineLP.disconnect();
        }, 700);
      }
      
      function playPowerOffClick(){
        if(!audio.ctx || !audio.noise) return;
        const ctx = audio.ctx;
        const now = ctx.currentTime;
        
        // Relay click
        const clickBP = ctx.createBiquadFilter();
        clickBP.type = 'bandpass';
        clickBP.frequency.value = 450;
        clickBP.Q.value = 3.5;
        
        const clickGain = ctx.createGain();
        clickGain.gain.setValueAtTime(0.0, now);
        clickGain.gain.linearRampToValueAtTime(0.18, now + 0.008);
        clickGain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
        
        audio.noise.connect(clickBP);
        clickBP.connect(clickGain);
        clickGain.connect(audio.master);
        
        setTimeout(() => {
          clickGain.disconnect();
          clickBP.disconnect();
        }, 100);
      }

      function registerWindow(winEl){
        const id = winEl.id;
        const taskBtn = makeTaskButton(winEl);
        windows.set(id, {el:winEl, task:taskBtn, minimized:false});
        attachDrag(winEl);
        attachResize(winEl);
        winEl.addEventListener('mousedown', ()=> focusWindow(id));
        winEl.querySelector('[data-close]').addEventListener('click', ()=> closeWindow(id));
        winEl.querySelector('[data-minimize]').addEventListener('click', ()=> minimizeWindow(id));
        if(winEl.hasAttribute('data-start-minimized')){ minimizeWindow(id); }
        else { focusWindow(id); }
      }

      function focusWindow(id, toggle){
        const w = windows.get(id); if(!w) return;
        // Toggle from taskbar
        if(toggle){
          if(w.minimized){ restoreWindow(id); return; }
          // if focused already and not minimized, minimize
          const active = parseInt(w.el.style.zIndex||0) >= z-1;
          if(active){ minimizeWindow(id); return; }
        }
        // Unminimize if needed
        if(w.minimized){ restoreWindow(id); }
        // deactivate others
        windows.forEach(obj=> obj.el.classList.add('inactive'));
        w.el.classList.remove('inactive');
        w.el.style.zIndex = ++z;
        windows.forEach(obj=> obj.task.classList.remove('active'));
        w.task.classList.add('active');
      }

      function minimizeWindow(id){
        const w = windows.get(id); if(!w) return;
        w.el.style.display='none';
        w.minimized=true;
        w.task.classList.remove('active');
      }

      function restoreWindow(id){
        const w = windows.get(id); if(!w) return;
        w.el.style.display='flex';
        w.minimized=false;
        focusWindow(id);
      }

      function closeWindow(id){
        const w = windows.get(id); if(!w) return;
        w.el.remove(); w.task.remove(); windows.delete(id);
      }

      function attachDrag(winEl){
        const handle = winEl.querySelector('[data-drag-handle]');
        let sx=0, sy=0, ox=0, oy=0, dragging=false;
        function onDown(e){
          const isLeft = (e.button===0 || e.touches);
          if(!isLeft) return;
          dragging=true; const p = getPos();
          sx = (e.touches? e.touches[0].clientX : e.clientX); sy = (e.touches? e.touches[0].clientY : e.clientY);
          ox = p.x; oy = p.y; document.addEventListener('mousemove', onMove);
          document.addEventListener('mouseup', onUp);
          document.addEventListener('touchmove', onMove, {passive:false});
          document.addEventListener('touchend', onUp);
        }
        function onMove(e){ if(!dragging) return; e.preventDefault?.();
          const rdesk = desktop.getBoundingClientRect();
          const wrect = winEl.getBoundingClientRect();
          const curX = (e.touches? e.touches[0].clientX : e.clientX);
          const curY = (e.touches? e.touches[0].clientY : e.clientY);
          const dX = curX - sx; const dY = curY - sy;
          let newL = ox + dX; let newT = oy + dY; // desktop-relative
          // constrain within desktop using desktop-relative coords
          const minL = 2;
          const minT = 2;
          const maxL = rdesk.width - wrect.width - 2;
          const maxT = rdesk.height - wrect.height - 2;
          newL = Math.min(Math.max(newL, minL), Math.max(minL, maxL));
          newT = Math.min(Math.max(newT, minT), Math.max(minT, maxT));
          winEl.style.left = newL + 'px';
          winEl.style.top = newT + 'px';
        }
        function onUp(){ dragging=false; document.removeEventListener('mousemove', onMove); document.removeEventListener('mouseup', onUp); document.removeEventListener('touchmove', onMove); document.removeEventListener('touchend', onUp); }
        function getPos(){ return { x: parseInt(winEl.style.left||'0'), y: parseInt(winEl.style.top||'0') }; }
        handle.addEventListener('mousedown', onDown);
        handle.addEventListener('touchstart', onDown, {passive:true});
      }

      function attachResize(winEl){
        const handles = ['n','s','e','w','ne','nw','se','sw'];
        handles.forEach(h=>{
          let el = winEl.querySelector('.resizer.'+h);
          if(!el){ el = document.createElement('div'); el.className='resizer '+h; winEl.appendChild(el); }
        });
        let startX=0, startY=0, startW=0, startH=0, startL=0, startT=0, dir=''; let resizing=false;
        const minW=280, minH=140;
        function down(e){
          const handle = e.target.closest('.resizer'); if(!handle) return; e.preventDefault?.();
          resizing=true; dir = [...handle.classList].find(c=>['n','s','e','w','ne','nw','se','sw'].includes(c));
          const rect = winEl.getBoundingClientRect(); const rdesk = desktop.getBoundingClientRect();
          startX = (e.touches? e.touches[0].clientX : e.clientX);
          startY = (e.touches? e.touches[0].clientY : e.clientY);
          startW = rect.width; startH = rect.height;
          startL = rect.left - rdesk.left; startT = rect.top - rdesk.top;
          document.addEventListener('mousemove', move);
          document.addEventListener('mouseup', up);
          document.addEventListener('touchmove', move, {passive:false});
          document.addEventListener('touchend', up);
        }
        function move(e){ if(!resizing) return; e.preventDefault?.();
          const rdesk = desktop.getBoundingClientRect();
          const curX = (e.touches? e.touches[0].clientX : e.clientX);
          const curY = (e.touches? e.touches[0].clientY : e.clientY);
          let dX = curX - startX; let dY = curY - startY;
          let newW = startW, newH = startH, newL = startL, newT = startT;
          if(dir.includes('e')) newW = Math.max(minW, startW + dX);
          if(dir.includes('s')) newH = Math.max(minH, startH + dY);
          if(dir.includes('w')){ newW = Math.max(minW, startW - dX); newL = startL + Math.min(dX, startW - minW); }
          if(dir.includes('n')){ newH = Math.max(minH, startH - dY); newT = startT + Math.min(dY, startH - minH); }
          // constrain within desktop
          const maxL = rdesk.width - newW - 2; const maxT = rdesk.height - newH - 2;
          newL = Math.min(Math.max(newL, 2), Math.max(2, maxL));
          newT = Math.min(Math.max(newT, 2), Math.max(2, maxT));
          winEl.style.width = newW + 'px';
          winEl.style.height = newH + 'px';
          winEl.style.left = newL + 'px';
          winEl.style.top = newT + 'px';
        }
        function up(){ resizing=false; document.removeEventListener('mousemove', move); document.removeEventListener('mouseup', up); document.removeEventListener('touchmove', move); document.removeEventListener('touchend', up); }
        winEl.addEventListener('mousedown', down);
        winEl.addEventListener('touchstart', down, {passive:false});
      }

      // Start menu
      startBtn.addEventListener('click', ()=>{
        startMenu.classList.toggle('open');
        uiDblClick();
      });
      document.addEventListener('click', (e)=>{
        if(!startMenu.contains(e.target) && e.target!==startBtn && !startBtn.contains(e.target)){
          startMenu.classList.remove('open');
        }
      });

      startMenu.addEventListener('click', (e)=>{
        const item = e.target.closest('[data-launch]'); if(!item) return;
        const what = item.dataset.launch;
        uiDblClick();
        if(what==='about'){ restoreWindow('win-about'); focusWindow('win-about'); }
        else if(what==='email'){ spawnEmail(); }
        else if(what==='notepad'){ spawnNotepad(); }
        else if(what==='files'){ spawnFiles(); }
        else if(what==='terminal'){ spawnTerminal(); }
        else if(what==='greenhouse'){ spawnGreenhouse(); }
        else if(what==='photolog'){ spawnPhotoLog(); }
        else if(what==='forest'){ spawnForestGame(); }
        else if(what==='dungeon'){ spawnRoguelike(); }
        else if(what==='regedit'){ spawnRegedit(); }
        startMenu.classList.remove('open');
      });

      // Desktop icon opens About
      aboutIcon.addEventListener('click', ()=>{ 
        uiDblClick(); 
        if(!document.getElementById('win-about')){
          // Recreate About window if it was closed
          const aboutWin = document.createElement('div');
          aboutWin.className = 'win';
          aboutWin.id = 'win-about';
          aboutWin.style.cssText = 'top:92px;left:120px;z-index:11;';
          aboutWin.innerHTML = `
            <div class="resizer n"></div>
            <div class="resizer s"></div>
            <div class="resizer e"></div>
            <div class="resizer w"></div>
            <div class="resizer ne"></div>
            <div class="resizer nw"></div>
            <div class="resizer se"></div>
            <div class="resizer sw"></div>
            <div class="titlebar" data-drag-handle>
              <div class="title bloom">ABOUT.TXT</div>
              <div class="btns">
                <div class="btn" data-minimize title="Minimize">_</div>
                <div class="btn" data-close title="Close">X</div>
              </div>
            </div>
            <div class="menubar">
              <div class="mitem">File</div>
              <div class="mitem">Edit</div>
              <div class="mitem">View</div>
              <div class="mitem">Help</div>
            </div>
            <div class="content">
              <pre class="bloom" style="margin:0;">
PHOSPHOR-95 MONO TUI
(c) 1995–2001 Retrotronics, Inc.

Welcome to your fantasy OS.
- Drag windows by the title bar.
- Use the Start button for apps.
- Click taskbar buttons to focus windows.
- Minimize with the _ button; close with X.

This UI blends Win95 layout with a low-res
monochrome CRT vibe: scanlines, vignette,
faint bloom, and phosphor green.

Climate monitoring keeps the arboretum
in perfect balance. 🌿
              </pre>
            </div>`;
          desktop.appendChild(aboutWin);
          registerWindow(aboutWin);
        }
        restoreWindow('win-about'); 
        focusWindow('win-about'); 
      });
      
      // Plant-themed desktop icons
      const plantNotesIcon = document.getElementById('plantNotesIcon');
      const waterLogIcon = document.getElementById('waterLogIcon');
      const greenhouseIcon = document.getElementById('greenhouseIcon');
      const photoGalleryIcon = document.getElementById('photoGalleryIcon');
      const emailIcon = document.getElementById('emailIcon');
      
      plantNotesIcon.addEventListener('click', ()=>{ uiDblClick(); spawnPlantNotes(); });
      waterLogIcon.addEventListener('click', ()=>{ uiDblClick(); spawnWaterLog(); });
      greenhouseIcon.addEventListener('click', ()=>{ uiDblClick(); spawnGreenhouse(); });
      photoGalleryIcon.addEventListener('click', ()=>{ uiDblClick(); spawnPhotoLog(); });
      emailIcon.addEventListener('click', ()=>{ uiDblClick(); spawnEmail(); });

      // Menubar item click sound
      document.addEventListener('click', (e)=>{
        const mi = e.target.closest('.menubar .mitem'); if(!mi) return;
        // ignore drags: only simple clicks reach here
        uiDblClick();
      });

      function createWindow({title, contentHTML, x=140, y=120, w=520, h=260}){
        const id = 'win-' + Math.random().toString(36).slice(2,8);
        const el = document.createElement('div');
        el.className='win';
        el.id=id; el.style.left=x+'px'; el.style.top=y+'px'; el.style.width=w+'px'; el.style.height=h+'px';
        el.innerHTML = `
          <div class="resizer n"></div>
          <div class="resizer s"></div>
          <div class="resizer e"></div>
          <div class="resizer w"></div>
          <div class="resizer ne"></div>
          <div class="resizer nw"></div>
          <div class="resizer se"></div>
          <div class="resizer sw"></div>
          <div class="titlebar" data-drag-handle>
            <div class="title bloom">${title}</div>
            <div class="btns">
              <div class="btn" data-minimize title="Minimize">_</div>
              <div class="btn" data-close title="Close">X</div>
            </div>
          </div>
          <div class="menubar">
            <div class="mitem">File</div>
            <div class="mitem">Edit</div>
            <div class="mitem">View</div>
          </div>
          <div class="content">${contentHTML}</div>
        `;
        desktop.appendChild(el);
        registerWindow(el);
        return el.id;
      }

      function spawnNotepad(){
        const content = `<textarea style="width:100%;height:100%;background:#071c13;color:var(--hi);border:1px solid var(--line);box-shadow:inset 0 0 0 1px #0c3b1a; font: inherit; outline:none; resize:none;">Type here...</textarea>`;
        createWindow({title:'NOTEPAD.TXT', contentHTML:content, x:180, y:140, w:460, h:260});
      }

      // === FOREST ADVENTURE GAME ===
      function spawnForestGame(){
        const gameState = {
          location: 'clearing',
          inventory: [],
          lanternOn: false,
          oakDoorOpen: false
        };

        const locations = {
          clearing: {
            desc: 'You stand in a moonlit clearing. Ancient oaks surround you. Silver ferns glow faintly in the darkness.\n\nPaths lead NORTH into darker woods, EAST to a garden, and SOUTH to a stream.',
            items: ['stick'],
            exits: {north: 'dark_woods', east: 'garden', south: 'stream'}
          },
          dark_woods: {
            desc: 'Dense forest blocks the moonlight. You can barely see. Strange whispers echo between the trees.\n\nYou can go SOUTH back to the clearing.',
            items: ['lantern'],
            exits: {south: 'clearing'},
            needsLight: true
          },
          garden: {
            desc: 'A wild garden blooms under the stars. Purple Crown flowers sway gently. A mossy stone door stands in an oak tree to the NORTH.\n\nYou can go WEST to the clearing.',
            items: ['key'],
            exits: {west: 'clearing', north: 'tree_door'}
          },
          stream: {
            desc: 'A crystal stream babbles over smooth stones. Violet Jewel plants sparkle with dew along the banks.\n\nYou can go NORTH back to the clearing.',
            items: ['flask'],
            exits: {north: 'clearing'}
          },
          tree_door: {
            desc: 'An ancient oak with a door carved into its trunk. The door is locked tight.',
            exits: {south: 'garden'},
            locked: true
          },
          secret_grove: {
            desc: '✨ You\'ve found the Secret Grove! Golden Fuzz fruits hang from luminescent vines. A chest sits beneath an elder tree.\n\n🎉 YOU WIN! You discovered the hidden sanctuary!',
            items: [],
            exits: {south: 'garden'}
          }
        };

        function renderGame(message = ''){
          const loc = locations[gameState.location];
          let output = `<div style="color:var(--hi); line-height:1.6;">\n${loc.desc}`;
          
          if(loc.needsLight && !gameState.lanternOn){
            output = `<div style="color:var(--hi); line-height:1.6;">\nIt's too dark to see anything! You hear rustling nearby...\n\nYou can go SOUTH.`;
          } else if(loc.items && loc.items.length > 0){
            output += `\n\n<span style="color:var(--med);">You see: ${loc.items.join(', ')}</span>`;
          }
          
          if(gameState.inventory.length > 0){
            output += `\n\n<span style="color:#4a9;">Inventory: ${gameState.inventory.join(', ')}</span>`;
          }
          
          output += `\n</div>`;
          
          if(message){
            output += `<div id="forestMessage" style="margin-top:8px;padding:8px;background:#0a2418;border:1px solid var(--line);color:var(--hi);min-height:40px;">${message}</div>`;
          } else {
            output += `<div id="forestMessage" style="margin-top:8px;padding:8px;background:#0a2418;border:1px solid var(--line);color:var(--med);min-height:40px;font-style:italic;">Enter a command...</div>`;
          }
          
          output += `<input type="text" id="forestInput" style="width:100%;margin-top:8px;background:#071c13;color:var(--hi);border:1px solid var(--line);padding:4px;font:inherit;outline:none;" placeholder="What do you do? (HELP for commands)" />`;
          return output;
        }

        function processCommand(cmd){
          const parts = cmd.toLowerCase().trim().split(' ');
          const action = parts[0];
          const target = parts.slice(1).join(' ');
          const loc = locations[gameState.location];

          if(action === 'help'){
            return 'Commands: LOOK, GO [direction], TAKE [item], USE [item], INVENTORY';
          }
          
          if(action === 'look'){
            return '[Looking around...]';
          }

          if(action === 'go'){
            const dir = target;
            if(loc.exits && loc.exits[dir]){
              const nextLoc = loc.exits[dir];
              if(nextLoc === 'tree_door' && !gameState.oakDoorOpen){
                return 'The oak door is locked. You need a key.';
              }
              if(nextLoc === 'secret_grove' && !gameState.oakDoorOpen){
                return 'The oak door is locked. You need a key.';
              }
              gameState.location = nextLoc;
              return '[Moving...]';
            }
            return 'You can\'t go that way.';
          }

          if(action === 'take'){
            if(loc.needsLight && !gameState.lanternOn){
              return 'It\'s too dark to see what you\'re reaching for!';
            }
            if(loc.items && loc.items.includes(target)){
              loc.items.splice(loc.items.indexOf(target), 1);
              gameState.inventory.push(target);
              return `You picked up the ${target}.`;
            }
            return 'You don\'t see that here.';
          }

          if(action === 'use'){
            if(!gameState.inventory.includes(target)){
              return 'You don\'t have that item.';
            }
            if(target === 'lantern'){
              gameState.lanternOn = !gameState.lanternOn;
              return gameState.lanternOn ? '💡 The lantern flickers to life!' : 'You extinguish the lantern.';
            }
            if(target === 'key' && gameState.location === 'tree_door'){
              gameState.oakDoorOpen = true;
              gameState.location = 'secret_grove';
              return '🔑 The key turns smoothly. The oak door swings open...';
            }
            return 'You can\'t use that here.';
          }

          if(action === 'inventory' || action === 'inv'){
            return gameState.inventory.length > 0 ? `You have: ${gameState.inventory.join(', ')}` : 'Your inventory is empty.';
          }

          return 'I don\'t understand that command. Type HELP for options.';
        }

        const winId = createWindow({title:'FOREST_ADVENTURE.EXE', contentHTML:renderGame(), x:200, y:100, w:540, h:400});

        function attachHandler(){
          const input = document.querySelector(`#${winId} #forestInput`);
          if(input){
            input.focus();
            input.addEventListener('keydown', (e) => {
              if(e.key === 'Enter'){
                e.preventDefault();
                const cmd = input.value;
                const result = processCommand(cmd);
                
                input.value = '';
                const win = document.getElementById(winId);
                if(win){
                  if(result === '[Moving...]' || result === '[Looking around...]'){
                    win.querySelector('.content').innerHTML = renderGame();
                  } else {
                    win.querySelector('.content').innerHTML = renderGame(result);
                  }
                  setTimeout(attachHandler, 10);
                }
              }
            });
          }
        }
        setTimeout(attachHandler, 50);
      }

      // === ROGUELIKE DUNGEON GAME ===
      function spawnRoguelike(){
        const game = {
          playerX: 5, playerY: 5,
          hp: 20, maxHp: 20,
          atk: 3, def: 1,
          gold: 0, level: 1,
          inventory: [],
          map: [],
          enemies: [],
          items: []
        };

        // Generate dungeon
        function generateDungeon(){
          game.map = Array(10).fill(null).map(() => Array(15).fill('.'));
          // Add walls
          for(let y=0; y<10; y++){
            for(let x=0; x<15; x++){
              if(y===0 || y===9 || x===0 || x===14 || Math.random() < 0.1){
                game.map[y][x] = '#';
              }
            }
          }
          // Clear player start
          game.map[5][5] = '.';
          
          // Spawn enemies
          game.enemies = [];
          for(let i=0; i<5; i++){
            let ex, ey;
            do {
              ex = Math.floor(Math.random()*13)+1;
              ey = Math.floor(Math.random()*8)+1;
            } while(game.map[ey][ex] !== '.' || (ex===5 && ey===5));
            game.enemies.push({x:ex, y:ey, hp:5, atk:2, type:['Slime','Rat','Bat'][i%3]});
          }
          
          // Spawn items
          game.items = [];
          for(let i=0; i<3; i++){
            let ix, iy;
            do {
              ix = Math.floor(Math.random()*13)+1;
              iy = Math.floor(Math.random()*8)+1;
            } while(game.map[iy][ix] !== '.' || (ix===5 && iy===5) || game.enemies.some(e=>e.x===ix&&e.y===iy));
            game.items.push({x:ix, y:iy, type:['potion','gold','sword'][i%3]});
          }
        }

        generateDungeon();

        function renderDungeon(){
          let output = '<div style="padding:8px;overflow:hidden;">';
          output += `<div style="margin-bottom:8px;color:var(--med);font-family:monospace;font-size:13px;">HP:${game.hp}/${game.maxHp} | ATK:${game.atk} | DEF:${game.def} | Gold:${game.gold} | Lvl:${game.level}</div>`;
          
          output += '<pre style="margin:0;color:var(--hi);font-family:monospace;font-size:14px;line-height:1.3;letter-spacing:2px;white-space:pre;overflow-x:auto;">';
          for(let y=0; y<10; y++){
            for(let x=0; x<15; x++){
              if(x === game.playerX && y === game.playerY){
                output += '<span style="color:#7aff7a;">@</span>';
              } else if(game.enemies.some(e => e.x===x && e.y===y)){
                output += '<span style="color:#f66;">E</span>';
              } else if(game.items.some(i => i.x===x && i.y===y)){
                output += '<span style="color:#fa0;">?</span>';
              } else {
                output += game.map[y][x] === '#' ? '<span style="color:#4a9;">█</span>' : '<span style="color:#1f6c1f;">·</span>';
              }
            }
            output += '\n';
          }
          output += '</pre>';
          
          output += `<div style="margin-top:8px;color:var(--med); font-size:11px;">WASD to move, Q to quit</div>`;
          if(game.inventory.length > 0){
            output += `<div style="color:#4a9; font-size:11px; margin-top:4px;">Items: ${game.inventory.join(', ')}</div>`;
          }
          output += '</div>';
          return output;
        }

        function movePlayer(dx, dy){
          const newX = game.playerX + dx;
          const newY = game.playerY + dy;
          
          if(newX < 0 || newX >= 15 || newY < 0 || newY >= 10) return false;
          if(game.map[newY][newX] === '#') return false;
          
          // Check enemy collision
          const enemy = game.enemies.find(e => e.x === newX && e.y === newY);
          if(enemy){
            // Combat!
            const damage = Math.max(1, game.atk - 1);
            enemy.hp -= damage;
            let msg = `You hit ${enemy.type} for ${damage} damage!`;
            if(enemy.hp <= 0){
              msg += ` ${enemy.type} defeated! +5 gold`;
              game.gold += 5;
              game.enemies = game.enemies.filter(e => e !== enemy);
            } else {
              const enemyDmg = Math.max(1, enemy.atk - game.def);
              game.hp -= enemyDmg;
              msg += `\n${enemy.type} hits you for ${enemyDmg} damage!`;
              if(game.hp <= 0){
                msg += '\n\n💀 You died! Game Over.';
                showDungeonMessage(msg);
                setTimeout(() => closeWindow(winId), 2000);
                return false;
              }
            }
            showDungeonMessage(msg);
            return true;
          }
          
          // Check item pickup
          const item = game.items.find(i => i.x === newX && i.y === newY);
          if(item){
            game.items = game.items.filter(i => i !== item);
            if(item.type === 'potion'){
              game.hp = Math.min(game.maxHp, game.hp + 10);
              showDungeonMessage('Found potion! +10 HP');
            } else if(item.type === 'gold'){
              game.gold += 10;
              showDungeonMessage('Found gold! +10 gold');
            } else if(item.type === 'sword'){
              game.atk += 2;
              showDungeonMessage('Found sword! +2 ATK');
              game.inventory.push('Sword');
            }
          }
          
          game.playerX = newX;
          game.playerY = newY;
          return true;
        }

        let messageTimeout = null;
        function showDungeonMessage(msg){
          const win = document.getElementById(winId);
          if(!win) return;
          const content = win.querySelector('.content');
          let msgDiv = content.querySelector('#dungeonMessage');
          if(!msgDiv){
            msgDiv = document.createElement('div');
            msgDiv.id = 'dungeonMessage';
            msgDiv.style.cssText = 'position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.9);border:2px solid var(--hi);padding:16px 24px;color:var(--hi);font-size:14px;max-width:80%;text-align:center;z-index:1000;white-space:pre-line;';
            content.style.position = 'relative';
            content.appendChild(msgDiv);
          }
          msgDiv.textContent = msg;
          msgDiv.style.display = 'block';
          if(messageTimeout) clearTimeout(messageTimeout);
          messageTimeout = setTimeout(() => {
            if(msgDiv) msgDiv.style.display = 'none';
          }, 2000);
        }

        const winId = createWindow({title:'DUNGEON.EXE', contentHTML:renderDungeon(), x:240, y:120, w:460, h:380});

        setTimeout(() => {
          document.addEventListener('keydown', function dungeonHandler(e){
            const win = document.getElementById(winId);
            if(!win) {
              document.removeEventListener('keydown', dungeonHandler);
              return;
            }
            
            let moved = false;
            if(e.key === 'w') moved = movePlayer(0, -1);
            else if(e.key === 's') moved = movePlayer(0, 1);
            else if(e.key === 'a') moved = movePlayer(-1, 0);
            else if(e.key === 'd') moved = movePlayer(1, 0);
            else if(e.key === 'q'){
              closeWindow(winId);
              return;
            }
            
            if(moved){
              win.querySelector('.content').innerHTML = renderDungeon();
            }
          });
        }, 50);
      }

      // === REGISTRY EDITOR ===
      function spawnRegedit(){
        const registry = {
          'HKEY_LOCAL_MACHINE': {
            'SOFTWARE': {
              'Phosphor95': {
                'Version': '1.0.0',
                'InstallDate': 'Jun 1994',
                'Theme': 'Greenhouse'
              },
              'Audio': {
                'HddSounds': 'enabled',
                'AmbientVolume': '0.22'
              }
            },
            'SYSTEM': {
              'CurrentControlSet': {
                'Greenhouse': {
                  'Temperature': '23C',
                  'Humidity': '68%',
                  'Zones': '3'
                }
              }
            }
          }
        };

        let currentPath = ['HKEY_LOCAL_MACHINE'];
        
        function getCurrentNode(){
          let node = registry;
          for(let key of currentPath){
            node = node[key];
          }
          return node;
        }

        function renderRegistry(){
          const node = getCurrentNode();
          let output = `<div style="color:var(--hi); line-height:1.6; padding:8px;">`;
          output += `<div style="color:var(--med); margin-bottom:8px; font-weight:bold;">Registry Editor</div>`;
          output += `<div style="color:#4a9; margin-bottom:8px; font-size:12px;">${currentPath.join('\\\\')}</div>`;
          output += `<div style="border:1px solid var(--line); padding:8px; background:#061810; height:280px; overflow-y:auto;">`;
          
          if(currentPath.length > 1){
            output += `<div style="color:var(--med); cursor:pointer; padding:2px;" onclick="window.regGoUp()">📁 ..</div>`;
          }
          
          for(let [key, value] of Object.entries(node)){
            if(typeof value === 'object'){
              output += `<div style="color:var(--hi); cursor:pointer; padding:2px;" onclick="window.regEnter('${key}')">📁 ${key}</div>`;
            } else {
              output += `<div style="color:var(--med); padding:2px; font-size:12px;"><span style="color:#4a9;">${key}</span> = "${value}"</div>`;
            }
          }
          
          output += `</div>`;
          output += `<div style="margin-top:8px; font-size:11px; color:var(--low);">⚠️ Editing disabled (read-only mode)</div>`;
          output += `</div>`;
          return output;
        }

        window.regEnter = (key) => {
          currentPath.push(key);
          const win = document.getElementById(winId);
          if(win) win.querySelector('.content').innerHTML = renderRegistry();
        };

        window.regGoUp = () => {
          if(currentPath.length > 1){
            currentPath.pop();
            const win = document.getElementById(winId);
            if(win) win.querySelector('.content').innerHTML = renderRegistry();
          }
        };

        const winId = createWindow({title:'REGEDIT.EXE', contentHTML:renderRegistry(), x:220, y:100, w:520, h:420});
      }

      function spawnFiles(){
        const fileContents = {
          'README.txt': `PHOSPHOR-95 GREENHOUSE SYSTEM
================================

Welcome to the Greenhouse Management System!

This system manages environmental controls,
plant databases, and research documentation
for botanical specimens.

For support, contact: botanist@greenhouse.local

Last updated: June 28, 1994`,
          'todo.txt': `TODO LIST - June 1994
=====================

☑ Install new ventilation fans (Zone B)
☑ Order humidity monitors
☐ Propagate Purple Crown specimen
☐ Document Dragon Scale flowering
☐ Reply to Dr. Yamamoto
☐ Update plant database
☐ Clean misting system
☐ Schedule greenhouse tour for Sarah`,
          'research_notes.txt': `RESEARCH NOTES - UNIDENTIFIED SPECIMENS
========================================

SPECIMEN X-47 "Purple Crown"
- Acquired: Estate sale, Oct 1993
- Flowering: May-June
- Structure: Lavender-like but distinct
- Hypothesis: Possible hybrid or rare variant
- Next: Send samples to university

SPECIMEN K-19 "Dragon Scale" 
- Challenging growth requirements
- Scales may be protective adaptation
- Temperature sensitive: 21-23°C optimal
- Note: Lost 2 cuttings learning curve

SPECIMEN B-22 "Pearl Bells"
- Extremely delicate
- Prefers consistent 21-22°C
- Low light tolerance
- Ghost-like appearance under grow lights`,
          'care_schedule.txt': `WEEKLY CARE SCHEDULE
====================

MONDAY:
- Check all zone temperatures
- Water Monstera & Philodendron
- Inspect for pests

WEDNESDAY: 
- Water ferns (keep moist!)
- Mist tropical zone
- Check humidity levels

FRIDAY:
- Water Pothos collection
- Dust large leaves
- Check grow light timers

SUNDAY:
- General inspection
- Photo documentation
- Update growth logs
- Plan next week`,
          'propagation.doc': `PROPAGATION GUIDE
==================

SUCCESSFUL TECHNIQUES:

Fern Division:
- Best in spring
- Keep humidity 70%+
- Mist twice daily
- Success rate: 85%

Stem Cuttings:
- Use clean, sharp shears
- Rooting hormone recommended
- Transparent dome for humidity
- 4-6 weeks to root

Air Layering:
- For woody specimens
- Monstera responds well
- Patience required
- Nearly 100% success rate

FAILED EXPERIMENTS:
- Dragon Scale cuttings (2/4 failed)
  Lesson: Needs bottom heat
- Pearl Bells division
  Too delicate, avoid`,
          'temp_log.txt': `TEMPERATURE LOG - JUNE 1994
============================

Date       Zone A   Zone B   Outdoor
--------------------------------------
Jun 20     23.1°C   19.5°C   25.3°C
Jun 21     23.4°C   19.8°C   26.1°C
Jun 22     23.2°C   19.2°C   24.8°C
Jun 23     22.8°C   20.1°C   23.9°C
Jun 24     23.5°C   19.7°C   27.2°C
Jun 25     23.0°C   19.4°C   25.6°C
Jun 26     22.9°C   19.9°C   24.3°C
Jun 27     23.3°C   19.6°C   26.8°C
Jun 28     23.2°C   19.8°C   25.1°C

AVG:       23.2°C   19.7°C   25.5°C
STATUS:    OPTIMAL  OPTIMAL  WARM`,
          'humidity.csv': `Date,Zone_A,Zone_B,Target_A,Target_B
Jun-20,67%,54%,65-75%,50-60%
Jun-21,69%,56%,65-75%,50-60%
Jun-22,68%,55%,65-75%,50-60%
Jun-23,71%,53%,65-75%,50-60%
Jun-24,66%,57%,65-75%,50-60%
Jun-25,70%,55%,65-75%,50-60%
Jun-26,68%,54%,65-75%,50-60%
Jun-27,72%,58%,65-75%,50-60%
Jun-28,68%,55%,65-75%,50-60%`,
          'species_list.txt': `GREENHOUSE SPECIES INVENTORY
=============================

ZONE A - TROPICAL (65-75% humidity)
- Monstera deliciosa (1)
- Philodendron sp. (1) 
- Ferns: Maidenhair, Boston (4)
- Specimen X-47 "Purple Crown" (1)
- Specimen B-22 "Pearl Bells" (1)
- Specimen R-08 "Ruby Burst" (1)

ZONE B - TEMPERATE (50-60% humidity)
- Pothos collection (3 varieties)
- Calathea sp. (2)
- Snake plants (3)
- Specimen M-31 "Shadow Leaf" (1)
- Specimen F-14 "Emerald Cascade" (1)

OUTDOOR SECTION
- Cherry trees (2, blooming)
- Various spring bulbs
- Specimen T-33 "Rose Guard" (1)
- Specimen V-29 "Crimson Heart" (1)

TOTAL: 24 specimens
UNIDENTIFIED: 8 specimens`
        };
        
        const fileTree = {
          'C:\\': {
            'GREENHOUSE': {
              'LOGS': {
                'temp_log.txt': '12 KB',
                'humidity.csv': '8 KB',
                'growth_data.xls': '24 KB',
                'maintenance.log': '6 KB'
              },
              'PHOTOS': {
                'specimen_x47.jpg': '156 KB',
                'dragon_scale.jpg': '142 KB',
                'pearl_bells.jpg': '138 KB',
                'ruby_burst.jpg': '145 KB',
                'emerald_fern.jpg': '151 KB'
              },
              'NOTES': {
                'care_schedule.txt': '4 KB',
                'propagation.doc': '18 KB',
                'species_list.txt': '6 KB',
                'observations.txt': '9 KB'
              },
              'BACKUPS': {
                'settings_jun01.bak': '2 KB',
                'database_jun15.bak': '45 KB'
              }
            },
            'APPS': {
              'email.exe': '84 KB',
              'notepad.exe': '32 KB',
              'terminal.exe': '48 KB',
              'photolog.exe': '96 KB'
            },
            'DOCS': {
              'research_notes.txt': '16 KB',
              'todo.txt': '2 KB',
              'README.txt': '1 KB',
              'journal_1994.doc': '67 KB'
            },
            'SYSTEM': {
              'drivers': {
                'display.sys': '12 KB',
                'audio.sys': '8 KB'
              },
              'fonts': {
                'phosphor.fnt': '24 KB'
              }
            },
            'CONFIG.SYS': '2 KB',
            'AUTOEXEC.BAT': '1 KB'
          }
        };
        
        let currentPath = 'C:\\';
        
        function renderFileList(){
          const parts = currentPath.split('\\').filter(p => p);
          let current = fileTree['C:\\'];
          
          for(let i = 1; i < parts.length; i++){
            current = current[parts[i]];
          }
          
          let html = `<div class="bloom">DIRECTORY: ${currentPath}</div>
            <hr style="border:none;border-top:1px solid var(--line); margin:6px 0;" />
            <div style="display:grid;grid-template-columns: 180px 1fr 80px;gap:6px;color:var(--med);max-height:200px;overflow-y:auto;">`;
          
          if(currentPath !== 'C:\\'){
            html += `<div style="cursor:pointer;color:var(--hi);" onclick="window.fileNavUp()">..</div><div>Parent Directory</div><div>dir</div>`;
          }
          
          for(let [name, value] of Object.entries(current)){
            if(typeof value === 'object'){
              html += `<div style="cursor:pointer;color:var(--hi);" onclick="window.fileNavInto('${name}')">${name}</div><div>Folder</div><div>dir</div>`;
            } else {
              const ext = name.split('.').pop().toLowerCase();
              const isViewable = ['txt', 'doc', 'csv', 'log'].includes(ext);
              const isExecutable = ext === 'exe';
              
              let fileStyle = '';
              let onClick = '';
              
              if(isViewable){
                fileStyle = 'cursor:pointer;color:#9fb;';
                onClick = `onclick="window.fileOpen('${name}')"`;
              } else if(isExecutable){
                fileStyle = 'cursor:pointer;color:#f96;';
                onClick = `onclick="window.fileExecute('${name}')"`;
              }
              
              html += `<div style="${fileStyle}" ${onClick}>${name}</div><div>File</div><div>${value}</div>`;
            }
          }
          
          html += '</div>';
          return html;
        }
        
        const content = renderFileList();
        const winId = createWindow({title:'FILE MANAGER', contentHTML:content, x:220, y:160, w:540, h:300});
        
        window.fileNavInto = (folder) => {
          currentPath += (currentPath.endsWith('\\') ? '' : '\\') + folder;
          const win = document.getElementById(winId);
          if(win) win.querySelector('.content').innerHTML = renderFileList();
        };
        
        window.fileNavUp = () => {
          if(currentPath === 'C:\\') return;
          const lastSlash = currentPath.lastIndexOf('\\');
          if(lastSlash <= 2){
            currentPath = 'C:\\';
          } else {
            currentPath = currentPath.substring(0, lastSlash);
          }
          const win = document.getElementById(winId);
          if(win) win.querySelector('.content').innerHTML = renderFileList();
        };
        
        window.fileOpen = (filename) => {
          const content = fileContents[filename];
          if(content){
            const viewerContent = `<div style="padding:8px;overflow-y:auto;height:100%;"><div class="bloom" style="margin-bottom:8px;">${filename}</div><pre style="color:var(--med);white-space:pre-wrap;line-height:1.5;margin:0;font-family:inherit;">${content}</pre></div>`;
            createWindow({title:filename.toUpperCase(), contentHTML:viewerContent, x:240+Math.random()*40, y:100+Math.random()*40, w:520, h:340});
          } else {
            const viewerContent = `<div style="padding:20px;text-align:center;color:var(--med);">
              <div class="bloom" style="margin-bottom:12px;">⚠️ CANNOT OPEN FILE</div>
              <div>${filename}</div>
              <div style="margin-top:8px;font-size:12px;">File contents not available</div>
            </div>`;
            createWindow({title:'ERROR', contentHTML:viewerContent, x:280, y:160, w:360, h:200});
          }
        };
        
        window.fileExecute = (filename) => {
          uiDblClick();
          const appMap = {
            'email.exe': spawnEmail,
            'notepad.exe': spawnNotepad,
            'terminal.exe': spawnTerminal,
            'photolog.exe': spawnPhotoLog
          };
          
          const app = appMap[filename];
          if(app){
            app();
          } else {
            const viewerContent = `<div style="padding:20px;text-align:center;color:var(--med);">
              <div class="bloom" style="margin-bottom:12px;">⚠️ CANNOT EXECUTE</div>
              <div>${filename}</div>
              <div style="margin-top:8px;font-size:12px;">Application not found</div>
            </div>`;
            createWindow({title:'ERROR', contentHTML:viewerContent, x:280, y:160, w:360, h:200});
          }
        };
      }

      function spawnTerminal(){
        const history = [];
        
        function executeCommand(cmd){
          const parts = cmd.trim().split(' ');
          const command = parts[0].toUpperCase();
          const args = parts.slice(1).join(' ');
          
          switch(command){
            case 'HELP':
              return 'Available commands:\n  HELP - Show this message\n  DIR - List directory contents\n  VER - Show system version\n  ECHO - Echo text\n  CLS - Clear screen\n  PLANT - Plant easter egg\n  GREENHOUSE - Environmental status\n  FOREST - Start forest adventure\n  DUNGEON - Start roguelike dungeon\n  REGEDIT - Registry editor\n  WHOAMI - Display user info';
            case 'DIR':
              return 'Directory of C:\\GREENHOUSE\n\n' +
                     'LOGS       &lt;DIR&gt;     Jun 28 1994\n' +
                     'PHOTOS     &lt;DIR&gt;     Jun 25 1994\n' +
                     'NOTES      &lt;DIR&gt;     Jun 20 1994\n' +
                     'README.TXT          2,048 bytes\n' +
                     '\n     3 Dir(s)     12 file(s)';
            case 'VER':
              return 'Phosphor-95 [Version 1.0.0]\nGreenhouse Edition';
            case 'ECHO':
              return args || '';
            case 'CLS':
              return '[CLEAR]';
            case 'PLANT':
              return '🌿 Growing plants takes patience...\n   Temperature: 23°C | Humidity: 68%\n   All zones operational.';
            case 'WHOAMI':
              return 'GREENHOUSE\\botanist\nPlant enthusiast & specimen curator';
            case 'GREENHOUSE':
              spawnGreenhouse();
              return '[Launching Greenhouse Monitor...]';
            case 'FOREST':
              spawnForestGame();
              return '[Loading Forest Adventure...]';
            case 'DUNGEON':
              spawnRoguelike();
              return '[Initializing Dungeon...]';
            case 'REGEDIT':
              spawnRegedit();
              return '[Opening Registry Editor...]';
            case '':
              return '';
            default:
              return `'${command}' is not recognized as a command.\nType HELP for available commands.`;
          }
        }
        
        function renderTerminal(){
          let output = 'Phosphor-95 Terminal [Version 1.0.0]\n(c) 1994 PhosphorSoft. Type HELP for commands.\n\n';
          history.forEach(h => {
            output += `C:\\> ${h.cmd}\n`;
            if(h.output && h.output !== '[CLEAR]') output += h.output + '\n';
          });
          output += 'C:\\> ';
          return `<div style="font-family:inherit;white-space:pre;color:var(--med);line-height:1.4;overflow-y:auto;height:calc(100% - 30px);">${output}</div>
            <input type="text" id="terminalInput" style="width:100%;background:#071c13;color:var(--hi);border:1px solid var(--line);padding:4px;font:inherit;outline:none;" placeholder="Type command..." />`;
        }
        
        const content = renderTerminal();
        const winId = createWindow({title:'TERMINAL', contentHTML:content, x:260, y:180, w:540, h:280});
        
        function attachInputHandler(){
          const input = document.querySelector(`#${winId} #terminalInput`);
          if(input){
            input.focus();
            input.addEventListener('keydown', (e) => {
              if(e.key === 'Enter'){
                e.preventDefault();
                const cmd = input.value;
                const output = executeCommand(cmd);
                
                if(output === '[CLEAR]'){
                  history.length = 0;
                } else {
                  history.push({cmd, output});
                }
                
                const win = document.getElementById(winId);
                if(win) {
                  win.querySelector('.content').innerHTML = renderTerminal();
                  setTimeout(() => attachInputHandler(), 10);
                }
              }
            });
          }
        }
        
        setTimeout(() => attachInputHandler(), 50);
      }

      function spawnPlantNotes(){
        const content = `<div class="bloom" style="margin-bottom:8px;">🌿 PLANT CARE NOTES</div>
          <div style="color:var(--med); line-height:1.6;">
          <strong style="color:var(--hi);">Monstera Deliciosa</strong><br/>
          • Water: Every 7-10 days when top 2" dry<br/>
          • Light: Bright indirect, 400-800 lux<br/>
          • Humidity: 60-80%<br/>
          • Last watered: 2 days ago<br/>
          <br/>
          <strong style="color:var(--hi);">Pothos Collection</strong><br/>
          • Water: Weekly, soil slightly moist<br/>
          • Light: Low to medium, 200-400 lux<br/>
          • Humidity: 50-70%<br/>
          • Last watered: 4 days ago<br/>
          <br/>
          <strong style="color:var(--hi);">Ferns (Maidenhair & Boston)</strong><br/>
          • Water: Keep consistently moist<br/>
          • Light: Indirect, filtered 300-500 lux<br/>
          • Humidity: 70-80% (mist daily)<br/>
          • Last watered: Today<br/>
          </div>`;
        createWindow({title:'PLANT_NOTES.TXT', contentHTML:content, x:200, y:120, w:480, h:380});
      }

      function spawnWaterLog(){
        const content = `<div class="bloom" style="margin-bottom:8px;">💧 WATERING SCHEDULE</div>
          <div style="color:var(--med); font-family:monospace; font-size:13px; line-height:1.5;">
          DATE       PLANT              AMOUNT    NOTES<br/>
          --------------------------------------------------------<br/>
          Oct 24     Ferns              500ml     Misting done<br/>
          Oct 22     Monstera           750ml     Leaves dusted<br/>
          Oct 20     Pothos (all 3)     600ml     Trimmed runners<br/>
          Oct 19     Calathea           400ml     Humidity ↑<br/>
          Oct 18     Snake Plants       300ml     Every 2 weeks<br/>
          Oct 17     Ferns              500ml     Extra misting<br/>
          Oct 15     Peace Lily         450ml     Wilting slight<br/>
          Oct 13     Philodendron       550ml     New growth!<br/>
          <br/>
          <span style="color:var(--hi);">NEXT DUE:</span><br/>
          • Ferns: Oct 26 (2 days)<br/>
          • Peace Lily: Oct 27 (3 days)<br/>
          • Monstera: Oct 31 (7 days)<br/>
          </div>`;
        createWindow({title:'WATER_LOG.CSV', contentHTML:content, x:180, y:100, w:540, h:420});
      }

      function spawnGreenhouse(){
        const content = `<div class="bloom" style="margin-bottom:8px;">🏡 GREENHOUSE ENVIRONMENTAL MONITOR</div>
          <div style="color:var(--med); line-height:1.7;">
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:12px;">
            <div>
              <strong style="color:var(--hi);">ZONE A - Tropical</strong><br/>
              🌡️ Temp: 23.2°C (Target: 22-24°C)<br/>
              💧 Humidity: 68% (Target: 65-75%)<br/>
              ☀️ Light: 620 lux<br/>
              💨 Airflow: Normal<br/>
              <span style="color:#4a9; font-size:11px;">● STATUS: OPTIMAL</span>
            </div>
            <div>
              <strong style="color:var(--hi);">ZONE B - Temperate</strong><br/>
              🌡️ Temp: 19.8°C (Target: 18-21°C)<br/>
              💧 Humidity: 55% (Target: 50-60%)<br/>
              ☀️ Light: 380 lux<br/>
              💨 Airflow: Normal<br/>
              <span style="color:#4a9; font-size:11px;">● STATUS: OPTIMAL</span>
            </div>
          </div>
          <hr style="border:none;border-top:1px solid var(--line); margin:10px 0;" />
          <strong style="color:var(--hi);">SYSTEM STATUS</strong><br/>
          • Grow lights: ON (Auto schedule 7:00-20:00)<br/>
          • Humidifiers: Active in Zone A<br/>
          • Ventilation: Cycling every 15 min<br/>
          • Water reservoir: 87% full<br/>
          • Misting system: Next cycle in 45 min<br/>
          <br/>
          <span style="color:#4a9;">All systems operational ✓</span>
          </div>`;
        createWindow({title:'GREENHOUSE_MONITOR.EXE', contentHTML:content, x:160, y:90, w:580, h:440});
      }

      function spawnPhotoLog(){
        const photos = [
          {
            url: 'images/f1a3498b-691c-43e7-bd29-7239fe3a7a0b_0_1.png',
            title: 'Spring Check-In',
            date: 'Apr 12, 1994',
            notes: `Perfect morning in the outdoor section! The early spring buds are finally showing. Everything feels so alive right now.\n\nTemperature was ideal today - warm enough to shed the jacket after the photo. Can't wait to see these trees fully bloom in a few weeks.\n\nReminder to self: Need to check the pH levels in Zone C this weekend.`
          },
          {
            url: 'images/f1a3498b-691c-43e7-bd29-7239fe3a7a0b_0_0.png',
            title: 'Cherry Blossom Progress',
            date: 'Apr 18, 1994',
            notes: `The cherry trees are doing AMAZING! Those pink buds I've been watching for weeks are finally opening up.\n\nHumidity has been perfect lately. The overalls are a new look - needed something practical with all the pockets for my pH meter and pruning shears.\n\nThese trees took 3 years to get to this point. Worth every second of patience.`
          },
          {
            url: 'images/73040fd8-3256-42fd-b784-f89f81813230_0_1.png',
            title: 'Specimen X-47 "Purple Crown"',
            date: 'May 3, 1994',
            notes: `This one's my favorite mystery plant. Found the seeds at that estate sale last year - still no idea what species it actually is.\n\nThe purple flowering spikes remind me of lavender but the structure is completely different. Thrives in Zone A with high humidity.\n\nIt's been growing for 8 months now. Going to try propagating it next month.`
          },
          {
            url: 'images/73040fd8-3256-42fd-b784-f89f81813230_0_0.png',
            title: 'Specimen B-22 "Pearl Bells"',
            date: 'May 8, 1994',
            notes: `These delicate white bell flowers just appeared this week! Almost ghostly how they glow under the grow lights.\n\nSuper sensitive to temperature changes - needs consistent 21-22°C. Had to move it away from the ventilation duct.\n\nThe way the buds cluster reminds me of lily of the valley, but the leaves are completely wrong for that family. Still researching.`
          },
          {
            url: 'images/73040fd8-3256-42fd-b784-f89f81813230_0_2.png',
            title: 'Specimen K-19 "Dragon Scale"',
            date: 'May 15, 1994',
            notes: `Look at those SCALES! The buds look almost reptilian - hence the nickname. The jagged leaves are a defense mechanism I think.\n\nThis one's been the most challenging. Needs very specific light levels and hates being overwatered. Lost two cuttings before I figured it out.\n\nThose purple-scaled buds should open in about a week. Can't wait to see what the flowers look like!`
          },
          {
            url: 'images/73040fd8-3256-42fd-b784-f89f81813230_0_3.png',
            title: 'Specimen M-31 "Shadow Leaf"',
            date: 'May 22, 1994',
            notes: `The dark green is so rich it's almost black in low light. These medium-large leaves are perfect - healthy, glossy, no spots.\n\nThis plant loves shade. Stuck it in the corner of Zone B and it's been thriving ever since. Barely needs any maintenance.\n\nThinking of propagating this one too - would look amazing in the entryway once it gets bigger.`
          },
          {
            url: 'images/aa9f127e-ecd2-41a6-9f98-73b69ad9f816_0_2.png',
            title: 'Specimen R-08 "Ruby Burst"',
            date: 'Jun 2, 1994',
            notes: `Those RED BUDS!! 😍 This is what I've been waiting for since February when I first got this plant.\n\nThe delicate branching structure makes it look like underwater coral. Very different from anything else in the collection.\n\nNeeds high humidity (70%+) and indirect light. The buds are so fragile - learned that the hard way when I bumped into it last week and lost a few.`
          },
          {
            url: 'images/aa9f127e-ecd2-41a6-9f98-73b69ad9f816_0_0.png',
            title: 'Specimen F-14 "Emerald Cascade"',
            date: 'Jun 10, 1994',
            notes: `My fern collection keeps growing and this one is the crown jewel. The fronds are so symmetrical and delicate.\n\nKeeping the soil consistently moist has been key. Also misting twice daily. The new growth at the center is always such a beautiful bright green.\n\nThis variety (still haven't fully ID'd it) seems more tolerant of lower light than my other ferns. Might be some kind of shade-adapted species.`
          },
          {
            url: 'images/947f2b72-4664-449f-bd85-a65fbcd7ae76_0_0.png',
            title: 'Specimen T-33 "Rose Guard"',
            date: 'Jun 18, 1994',
            notes: `Nature's perfect defense system! Those thorny leaves protect the softest pink buds I've ever seen.\n\nIt's like the plant is saying "look but don't touch." The contrast between the aggressive thorns and delicate flowers is incredible.\n\nHad to wear thick gloves just to water this one. Definitely keeping it away from high-traffic areas. Worth the extra caution though - just look at it!`
          },
          {
            url: 'images/947f2b72-4664-449f-bd85-a65fbcd7ae76_0_2.png',
            title: 'Specimen V-29 "Crimson Heart"',
            date: 'Jun 25, 1994',
            notes: `That dark red center though! The color gradient from the deep green edges to the burgundy center is mesmerizing.\n\nThis one responds really well to the mineral mix I've been using. The leaves get more vibrant when it's happy.\n\nI've been documenting the color changes over the season. The center gets darker as it matures. Some kind of pigment response to maturity maybe? Need to research more.`
          },
          {
            url: 'images/947f2b72-4664-449f-bd85-a65fbcd7ae76_0_1.png',
            title: 'Specimen O-17 "Sunset Clusters"',
            date: 'Jun 28, 1994',
            notes: `Orange leaf clusters mixed with the green! And look at those delicate white buds blooming at the top - perfect timing.\n\nThis plant has such unique coloring. The orange isn't from stress or dying - it's actually part of its natural growth pattern.\n\nThe white blooms only last about 3 days, so I'm lucky I caught them. So fragile and ethereal. Makes me think of cherry blossoms but miniature.`
          },
          {
            url: 'images/b25a1ab5-16ad-4bdd-b496-2a1e2e1ef311_0_3.png',
            title: 'Specimen Y-24 "Golden Fuzz"',
            date: 'Jul 2, 1994',
            notes: `It's growing FRUIT!! Little plump yellow things that look like fuzzy cherries. I was NOT expecting this!\n\nThey're slightly fuzzy to the touch, almost like tiny peaches. No idea if they're edible - definitely not testing that theory though.\n\nTook about 6 months from planting to fruiting. The plant itself is pretty unassuming, but these golden fruits are adorable. Dr. Yamamoto is going to flip when he sees these on Thursday!`
          },
          {
            url: 'images/ab6e63db-2b87-4f3e-b275-85c9041c9ae9_0_0.png',
            title: 'Specimen L-41 "Violet Jewel"',
            date: 'Jul 6, 1994',
            notes: `The dewdrops this morning made it look BEDAZZLED! The violet leaves are stunning on their own, but with the water droplets... wow.\n\nThe delicate violet blooms match the leaf color exactly - same gorgeous shade of purple throughout. Very rare to see that kind of color consistency.\n\nHigh humidity is key for this one. It loves the misting system. The dew makes those leaves look like they're covered in crystals.`
          },
          {
            url: 'images/ab6e63db-2b87-4f3e-b275-85c9041c9ae9_0_2.png',
            title: 'Specimen W-09 "Paradox Tree"',
            date: 'Jul 10, 1994',
            notes: `This is WILD. Moss-covered branches growing vibrant tropical flowers right from the middle of a bent branch. How??\n\nThe contrast between the ancient-looking moss and the bright fresh flowers is so bizarre. It's like a rainforest tree compressed into one specimen.\n\nI keep checking to make sure the flowers are actually growing from the branch and not just sitting there. They are! Nature is incredible. This one's definitely going in my research paper.`
          },
          {
            url: 'images/f24ebf8c-00a4-4ac9-b0c2-a3315d35081f_0_3.png',
            title: 'Specimen H-52 "Mist Heads"',
            date: 'Jul 14, 1994',
            notes: `Close-up of these low-growing heads in the morning mist. Not lettuce, not tulips, not quite like anything I've seen before.\n\nThey're almost sea-plant-like but definitely terrestrial. The big leaf heads emerge from low rosettes. Love the sculptural quality.\n\nThe mist really brings out their texture. They seem to drink it in through the leaves. Zone B's humidity levels are perfect for these odd beauties.`
          },
          {
            url: 'images/e37b3157-5aba-4c60-8a41-2dab49f7be6f_0_2.png',
            title: 'Specimen H-52 "Mist Heads" (Evening)',
            date: 'Jul 14, 1994',
            notes: `Same plant as this morning but in low light without the mist. Everything goes VIOLET in these conditions!\n\nThe color shift is dramatic. In bright light they're more green-purple, but in shade they're pure violet. Some kind of anthocyanin response maybe?\n\nThey seem to prefer this low light actually. More vibrant, less stress. Keeping them in the shadier section permanently.`
          },
          {
            url: 'images/ee2339b9-9c69-4ace-9cdd-9c6a14853d89_0_1.png',
            title: 'Specimen N-36 "Red Spire"',
            date: 'Jul 18, 1994',
            notes: `Looks like lavender but it's RED! Growing from a proper bush too - this thing is getting big.\n\nThe spire-like flower stalks shoot up about 8 inches above the foliage. Smells amazing, kind of spicy-sweet. Not like regular lavender at all.\n\nStarted as a tiny cutting in March. It's tripled in size. Might need to move it to a bigger container soon or transplant to the ground bed.`
          },
          {
            url: 'images/d0ba5de8-c824-4c7d-8479-33e15a2cf518_0_2.png',
            title: 'Specimen A-61 "Sponge Bloom"',
            date: 'Jul 22, 1994',
            notes: `This one definitely looks aquatic even though it's not underwater! Dark photo but you can see those yellow sponge-like petals.\n\nThe stalks are pretty rigid, almost bamboo-like. Then they bloom into these soft, porous-looking yellow things. Very weird texture.\n\nKeeping it extra humid to simulate its natural habitat. It seems happy. The blooms last about a week before they start to fade. First time it's flowered for me!`
          },
          {
            url: 'images/d0ba5de8-c824-4c7d-8479-33e15a2cf518_0_1.png',
            title: 'Specimen P-73 "Cotton Cascade"',
            date: 'Jul 26, 1994',
            notes: `Indoor forest vibes!! Huge green leaves as a backdrop, pink lavender-like spikes, AND fluffy white flowers all in one shot.\n\nPretty sure the white fluffy bits and the pink spikes are on the same vine system - still figuring out the growth pattern. It's complex!\n\nThe bright light really makes the colors pop. This section gets afternoon sun and everything loves it. Definitely one of my most photogenic plant combos.`
          },
          {
            url: 'images/d0ba5de8-c824-4c7d-8479-33e15a2cf518_0_3.png',
            title: 'Specimen S-18 "Bronze Crown"',
            date: 'Jul 30, 1994',
            notes: `Succulent close-up! The dark brown and green coloring is so rich. These rosettes are super healthy right now.\n\nSucculents are lower maintenance than most of my collection but I still love them. The color variation as they mature is fascinating to track.\n\nThese are propagated from leaves I collected last fall. They're finally showing their true colors. The brown edges are completely natural - sign of maturity, not stress.`
          },
          {
            url: 'images/d0ba5de8-c824-4c7d-8479-33e15a2cf518_0_0.png',
            title: 'Specimen D-88 "Berry Puffs"',
            date: 'Aug 3, 1994',
            notes: `What even IS this?? Small balls that look like dandelions growing periwinkle blueberries. I love it.\n\nThe puff-ball seed heads are one thing, but those blue berry clusters are completely unexpected. Both on the same plant!\n\nFound this as a wildflower seed mix donation. No idea what it actually is but it's thriving. The blue color is so vibrant against the green leaves. Saving seeds from this one for sure.`
          },
          {
            url: 'images/f2a69596-e20d-401f-a17b-753f3ec44761_0_2.png',
            title: 'Sarah\'s Visit!',
            date: 'Aug 7, 1994',
            notes: `Sarah came by for the tour I promised her! Had to take a silly selfie with my plant babies in the background.\n\nI refuse to be serious in my own greenhouse lol. Tongue out, zero regrets. The plants don't judge me.\n\nShe was amazed by the collection. Spent three hours talking about propagation techniques and traded some cuttings. Best day ever! This is what it's all about - sharing the plant love. 🌿`
          }
        ];

        const content = `<div class="bloom" style="margin-bottom:8px;">📷 PHOTO LOG - Plant Collection 1994</div>
          <div class="gallery-grid" id="photoGalleryGrid"></div>`;
        
        const winId = createWindow({title:'PHOTO_LOG.EXE', contentHTML:content, x:140, y:80, w:620, h:480});
        
        // Populate gallery after window is created
        setTimeout(()=>{
          const grid = document.querySelector(`#${winId} .gallery-grid`);
          if(!grid) return;
          
          photos.forEach((photo, idx) => {
            const thumb = document.createElement('div');
            thumb.className = 'gallery-thumb bloom';
            thumb.style.backgroundImage = `url(${photo.url})`;
            thumb.title = photo.title;
            thumb.onclick = () => openPhotoViewer(photos, idx);
            grid.appendChild(thumb);
          });
        }, 50);
      }

      function spawnEmail(){
        const emails = [
          {
            from: 'GreenThumb Supply Co.',
            subject: 'Your Order #4721 Has Shipped!',
            date: 'Jun 28, 1994',
            unread: true,
            folder: 'inbox',
            body: `Dear Valued Customer,

Great news! Your order has been shipped and is on its way to you.

Order Details:
- Humidity Monitor (Digital, Model HM-300)
- pH Test Kit (Premium, 100 strips)
- Grow Light Bulbs (6500K, Set of 4)
- Propagation Dome (12" clear acrylic)

Tracking #: GT-94-28745-B
Estimated Delivery: Jul 2-5, 1994

Thank you for choosing GreenThumb Supply Co.!

- The GreenThumb Team`
          },
          {
            from: 'Sarah Chen',
            subject: 'Re: That mystery plant ID',
            date: 'Jun 25, 1994',
            unread: true,
            folder: 'inbox',
            body: `Hey!

I showed the photo to my botany professor and she was stumped too! She said it *might* be some kind of hybrid Lavandula but the leaf structure is all wrong. The flowering spikes are definitely unusual.

Have you tried posting it to the BotanyNet forums? Someone there might recognize it. Also, if you can get a close-up of the flower structure when it fully blooms, that would help a lot.

Let me know if you figure it out! I'm dying to know what it is now.

- Sarah

P.S. Still planning to visit your greenhouse next month?`
          },
          {
            from: 'Marcus Rodriguez',
            subject: 'Greenhouse ventilation upgrade',
            date: 'Jun 22, 1994',
            unread: false,
            folder: 'inbox',
            body: `Hi,

I finished installing the new ventilation fans in Zone B yesterday. Everything is working great - the temperature is already more stable.

I noticed the humidifier in Zone A is making a weird noise. Probably just needs cleaning but I can take a look next week if you want.

Invoice attached (kidding, it's in the mail).

Let me know when you want to schedule the misting system expansion.

Best,
Marcus
Marcus Rodriguez HVAC & Environmental Systems`
          },
          {
            from: 'BotanyNet Digest',
            subject: 'Weekly Digest #26 - Rare Species Alert',
            date: 'Jun 20, 1994',
            unread: false,
            folder: 'inbox',
            body: `BOTANYNET WEEKLY DIGEST
Issue #26 - June 20, 1994

RARE SPECIES ALERT:
New Fern Variant Discovered in Pacific Northwest
Read more on page 3...

FEATURED DISCUSSION:
"Humidity Control for Tropical Species"
142 replies - Hot topic this week!

MARKETPLACE:
- Rare Philodendron cuttings available
- Looking for: Monstera albo variegata
- Estate sale find: Victorian greenhouse equipment

EVENTS:
Northwest Botanical Conference - Aug 12-14
Registration closes July 15

To unsubscribe, reply with UNSUBSCRIBE in subject.`
          },
          {
            from: 'Jennifer Park',
            subject: 'Coffee soon?',
            date: 'Jun 18, 1994',
            unread: false,
            folder: 'inbox',
            body: `Hey you!

I feel like I haven't seen you in forever. Want to grab coffee this weekend? 

I know you're probably buried in your greenhouse (as usual 😊) but you need to come up for air sometimes!

Let me know if Sunday works?

- Jen`
          },
          {
            from: 'Botanical Society',
            subject: 'Membership Renewal Reminder',
            date: 'Jun 15, 1994',
            unread: false,
            folder: 'inbox',
            body: `Dear Member,

This is a friendly reminder that your Botanical Society membership will expire on July 31, 1994.

Renew now to continue enjoying:
- Quarterly journal delivery
- Garden & greenhouse access
- Member-only plant sales
- Expert consultation services

Renewal Fee: $45/year

Please send payment to:
Botanical Society
P.O. Box 892
Portland, OR 97201

Thank you for your continued support!

- Membership Services`
          },
          {
            from: 'Tom Richardson',
            subject: "RE: Can't make it tomorrow",
            date: 'Jun 12, 1994',
            unread: false,
            folder: 'inbox',
            body: `No worries at all! I totally understand - plant emergencies wait for no one. 😄

The Dragon Scale sounds intense. Hope you can save it!

Let's reschedule for next week. I'd love to see your setup anyway - you've been talking about those new specimens for months.

Talk soon,
Tom`
          },
          {
            from: 'Dr. Helen Yamamoto',
            subject: 'Research collaboration opportunity',
            date: 'Jun 10, 1994',
            unread: false,
            folder: 'inbox',
            body: `Dear Colleague,

Your name was recommended to me by Sarah Chen regarding your work with rare and unidentified plant species.

I'm conducting research on adaptive traits in cultivated vs. wild specimens and I'm looking for collaborators with extensive private collections.

Would you be interested in discussing this further? I'd be happy to visit your greenhouse facility to learn more about your collection and methods.

Best regards,

Dr. Helen Yamamoto
Department of Botany
University of Oregon`
          },
          {
            from: 'SPAM-NET',
            subject: '$$$ MAKE MONEY FAST $$$',
            date: 'Jun 8, 1994',
            unread: false,
            folder: 'spam',
            body: `***AMAZING OPPORTUNITY***

WORK FROM HOME!!!
NO EXPERIENCE NEEDED!!!
EARN $5000 PER WEEK!!!

THIS IS NOT A SCAM!!! SEND $29.95 TO:
MONEYFAST ENTERPRISES
P.O. BOX [...]

ACT NOW!!! LIMITED TIME OFFER!!!`
          },
          {
            from: 'Lisa Kowalski',
            subject: 'Your fern cuttings are thriving!',
            date: 'Jun 5, 1994',
            unread: false,
            folder: 'inbox',
            body: `Hi!

Just wanted to let you know the Emerald Cascade cuttings you gave me last month are doing AMAZING! I followed your instructions exactly and they're already putting out new growth.

You're a plant wizard! 🌿

If you ever need anything propagated or want to trade cuttings, let me know. I've got some interesting succulents that might do well in your temperate zone.

Thanks again!

Lisa`
          },
          {
            from: 'Automated System',
            subject: 'ALERT: Zone A Temperature Spike',
            date: 'Jun 3, 1994',
            unread: false,
            folder: 'inbox',
            body: `GREENHOUSE MONITORING SYSTEM
ALERT NOTIFICATION

Zone: A (Tropical)
Alert Type: Temperature High
Value: 26.8°C (Target: 22-24°C)
Time: 14:32
Date: June 3, 1994

Possible Causes:
- Ventilation system issue
- Excessive solar exposure
- Humidifier heat buildup

Recommended Action:
Check ventilation fan status and adjust shading.

[This is an automated message]`
          },
          {
            from: 'Dave Chen',
            subject: 'Thanks for the plant advice!',
            date: 'Jun 1, 1994',
            unread: false,
            folder: 'inbox',
            body: `Hey,

Just wanted to say thanks for all the advice on keeping those Pothos alive. Turns out I was WAY overwatering them. 😅

They're already looking better after I followed your instructions. You really know your stuff!

If you ever need any computer help, let me know - it's the least I can do.

Cheers,
Dave`
          },
          {
            from: 'Pacific Seed Exchange',
            subject: 'New Exotic Seeds In Stock!',
            date: 'May 28, 1994',
            unread: false,
            folder: 'inbox',
            body: `PACIFIC SEED EXCHANGE
Summer 1994 Catalog Highlights

NEW ARRIVALS:
🌱 Rare Fern Spores (5 varieties)
🌱 Exotic Flowering Vines
🌱 Heritage Vegetable Seeds
🌱 Tropical Specimen Seeds

SPECIAL OFFER:
Order $50+ and get FREE propagation supplies!
(Offer expires July 15, 1994)

Request our full catalog:
Call: 1-800-SEEDS-94
Or visit our store in Eugene, OR

Happy Growing!
- Pacific Seed Exchange Team`
          },
          {
            from: 'Mom',
            subject: 'Sunday dinner?',
            date: 'May 25, 1994',
            unread: false,
            folder: 'inbox',
            body: `Hi honey,

Are you free for dinner this Sunday? I'm making lasagna.

Also, your father wants to know if you can help him with his tomato plants - he says they're "looking sad" and he doesn't know why. I told him you're not a vegetable person but he insists. 😊

Let me know!

Love,
Mom

P.S. Bring some of those beautiful flowers if any are blooming!`
          },
          {
            from: 'Equipment Depot',
            subject: 'Your Inquiry: Industrial Humidifiers',
            date: 'May 20, 1994',
            unread: false,
            folder: 'inbox',
            body: `Dear Customer,

Thank you for your inquiry about industrial-grade humidifiers for greenhouse applications.

Based on your requirements (Zone coverage: 400 sq ft, Target humidity: 65-75%), we recommend:

Model: HydroMist Pro 400
Capacity: 12 gallons/day
Coverage: Up to 500 sq ft
Price: $385.00

Features:
- Automatic humidity sensor
- Timer function
- Low water indicator
- Quiet operation

Would you like us to prepare a quote? We offer installation services in the Portland area.

Contact us: (503) 555-7829

Best regards,
Equipment Depot Sales Team`
          },
          {
            from: 'Me',
            subject: 'Re: Research collaboration opportunity',
            date: 'Jun 11, 1994',
            unread: false,
            folder: 'outbox',
            body: `Dr. Yamamoto,

Thank you for reaching out! I'd be very interested in discussing collaboration opportunities.

I've been working with several unidentified species for the past few years, and having academic support for proper identification and documentation would be invaluable.

I'm available for a greenhouse tour any weekday afternoon or weekend. My facility has two primary climate zones plus an outdoor section.

Please let me know what works best for your schedule.

Best regards`
          },
          {
            from: 'Me',
            subject: 'Re: Coffee soon?',
            date: 'Jun 19, 1994',
            unread: false,
            folder: 'outbox',
            body: `Jen!

Sunday sounds perfect! How about 2pm at The Green Bean?

Sorry I've been so buried lately - you know how it gets when the specimens start blooming. But you're absolutely right, I need to see actual humans sometimes. 😊

See you Sunday!`
          },
          {
            from: 'Deleted Item',
            subject: 'Old Equipment Quote',
            date: 'Mar 15, 1994',
            unread: false,
            folder: 'trash',
            body: `[Deleted email content]

This message was deleted on Apr 2, 1994.`
          }
        ];

        let currentEmail = null;
        let currentFolder = 'inbox';
        
        function getFolderEmails(){
          return emails.filter(e => e.folder === currentFolder);
        }
        
        function renderFolders(){
          const counts = {
            inbox: emails.filter(e => e.folder === 'inbox').length,
            outbox: emails.filter(e => e.folder === 'outbox').length,
            spam: emails.filter(e => e.folder === 'spam').length,
            trash: emails.filter(e => e.folder === 'trash').length
          };
          return `
            <div class="email-folder ${currentFolder === 'inbox' ? 'active' : ''}" onclick="window.switchFolder('inbox')">
              Inbox <span class="email-folder-count">(${counts.inbox})</span>
            </div>
            <div class="email-folder ${currentFolder === 'outbox' ? 'active' : ''}" onclick="window.switchFolder('outbox')">
              Outbox <span class="email-folder-count">(${counts.outbox})</span>
            </div>
            <div class="email-folder ${currentFolder === 'spam' ? 'active' : ''}" onclick="window.switchFolder('spam')">
              Spam <span class="email-folder-count">(${counts.spam})</span>
            </div>
            <div class="email-folder ${currentFolder === 'trash' ? 'active' : ''}" onclick="window.switchFolder('trash')">
              Trash <span class="email-folder-count">(${counts.trash})</span>
            </div>
          `;
        }
        
        function renderEmailList(){
          const folderEmails = getFolderEmails();
          if(folderEmails.length === 0) {
            return '<div style="padding:20px;text-align:center;color:var(--med);">No emails in this folder</div>';
          }
          return folderEmails.map((email) => {
            const idx = emails.indexOf(email);
            return `<div class="email-item ${email.unread ? 'unread' : ''}" onclick="window.selectEmail(${idx})">
              <div class="email-from">${email.from}</div>
              <div class="email-subject">${email.subject}</div>
              <div class="email-date">${email.date}</div>
            </div>`;
          }).join('');
        }
        
        function renderEmailPreview(){
          if(currentEmail === null) {
            return '<div style="padding:20px;text-align:center;color:var(--med);">Select an email to read</div>';
          }
          const email = emails[currentEmail];
          return `<div class="email-header bloom">
            <div><strong style="color:var(--hi);">From:</strong> ${email.from}</div>
            <div><strong style="color:var(--hi);">Subject:</strong> ${email.subject}</div>
            <div><strong style="color:var(--hi);">Date:</strong> ${email.date}</div>
          </div>
          <div class="email-body">${email.body}</div>`;
        }
        
        const content = `<div class="email-layout">
          <div class="email-folders bloom" id="emailFolders">${renderFolders()}</div>
          <div class="email-list bloom" id="emailList">${renderEmailList()}</div>
          <div class="email-preview bloom" id="emailPreview">${renderEmailPreview()}</div>
        </div>`;
        
        const winId = createWindow({title:'📧 E-MAIL CLIENT', contentHTML:content, x:100, y:70, w:740, h:500});
        
        window.selectEmail = (idx) => {
          currentEmail = idx;
          emails[idx].unread = false;
          const win = document.getElementById(winId);
          if(win) {
            win.querySelector('#emailList').innerHTML = renderEmailList();
            win.querySelector('#emailPreview').innerHTML = renderEmailPreview();
          }
        };
        
        window.switchFolder = (folder) => {
          currentFolder = folder;
          currentEmail = null;
          const win = document.getElementById(winId);
          if(win) {
            win.querySelector('#emailFolders').innerHTML = renderFolders();
            win.querySelector('#emailList').innerHTML = renderEmailList();
            win.querySelector('#emailPreview').innerHTML = renderEmailPreview();
          }
        };
      }

      function openPhotoViewer(photos, startIdx){
        let currentIdx = startIdx;
        
        function renderViewer(){
          const photo = photos[currentIdx];
          return `<div class="photo-viewer">
            <div class="photo-main">
              <div class="photo-img" style="background-image:url(${photo.url})"></div>
              <div class="photo-nav">
                <button onclick="window.photoViewerPrev()">← Previous</button>
                <span class="bloom" style="padding:6px 12px;">${currentIdx + 1} / ${photos.length}</span>
                <button onclick="window.photoViewerNext()">Next →</button>
              </div>
            </div>
            <div class="photo-notes bloom">
              <h3>${photo.title}</h3>
              <div style="color:#6b6; margin-bottom:8px; font-size:12px;">${photo.date}</div>
              <div style="white-space:pre-wrap;">${photo.notes}</div>
            </div>
          </div>`;
        }
        
        const winId = createWindow({title:'PHOTO VIEWER', contentHTML:renderViewer(), x:120, y:60, w:720, h:520});
        
        // Global nav functions for this viewer
        window.photoViewerNext = () => {
          currentIdx = (currentIdx + 1) % photos.length;
          const win = document.getElementById(winId);
          if(win) win.querySelector('.content').innerHTML = renderViewer();
        };
        
        window.photoViewerPrev = () => {
          currentIdx = (currentIdx - 1 + photos.length) % photos.length;
          const win = document.getElementById(winId);
          if(win) win.querySelector('.content').innerHTML = renderViewer();
        };
      }

      // Register initial About window
      registerWindow(document.getElementById('win-about'));

      // Ambient audio system - CRT + greenhouse atmosphere
      const AudioCtx = window.AudioContext || window.webkitAudioContext;
      const audio = { ctx:null, master:null, started:false, noise:null, hddTimer:null, ambienceTimer:null };
      
      function initAudio(){
        if(audio.started || !AudioCtx) return;
        const ctx = new AudioCtx(); 
        audio.ctx = ctx;
        const master = ctx.createGain(); 
        master.gain.value = 0.0; 
        master.connect(ctx.destination); 
        audio.master = master;
        
        // === CRT MONITOR HUM (60Hz + 120Hz harmonics) ===
        const humGain = ctx.createGain(); 
        humGain.gain.value = 0.08; 
        humGain.connect(master);
        
        // Fundamental 60Hz
        const hum60 = ctx.createOscillator(); 
        hum60.type = 'sine'; 
        hum60.frequency.value = 60;
        const h60g = ctx.createGain(); 
        h60g.gain.value = 1.0;
        hum60.connect(h60g); 
        h60g.connect(humGain);
        
        // 120Hz harmonic (stronger)
        const hum120 = ctx.createOscillator(); 
        hum120.type = 'sine'; 
        hum120.frequency.value = 120;
        const h120g = ctx.createGain(); 
        h120g.gain.value = 0.5;
        hum120.connect(h120g); 
        h120g.connect(humGain);
        
        // 180Hz harmonic (subtle)
        const hum180 = ctx.createOscillator(); 
        hum180.type = 'sine'; 
        hum180.frequency.value = 180;
        const h180g = ctx.createGain(); 
        h180g.gain.value = 0.15;
        hum180.connect(h180g); 
        h180g.connect(humGain);
        
        // Slow LFO for organic hum variation
        const lfo1 = ctx.createOscillator(); 
        lfo1.frequency.value = 0.17;
        const lfo1g = ctx.createGain(); 
        lfo1g.gain.value = 1.5;
        lfo1.connect(lfo1g); 
        lfo1g.connect(hum60.frequency);
        
        // Faster subtle wobble
        const lfo2 = ctx.createOscillator(); 
        lfo2.frequency.value = 0.43;
        const lfo2g = ctx.createGain(); 
        lfo2g.gain.value = 0.8;
        lfo2.connect(lfo2g); 
        lfo2g.connect(hum120.frequency);
        
        // === BROADBAND NOISE (CRT hiss + air) ===
        const noiseBuf = ctx.createBuffer(1, ctx.sampleRate * 3, ctx.sampleRate);
        const ch = noiseBuf.getChannelData(0);
        for(let i=0; i<ch.length; i++){ 
          ch[i] = (Math.random() * 2 - 1) * 0.35; 
        }
        const noise = ctx.createBufferSource(); 
        noise.buffer = noiseBuf; 
        noise.loop = true;
        audio.noise = noise;
        
        // High-freq CRT hiss
        const hissFilter = ctx.createBiquadFilter(); 
        hissFilter.type = 'highpass'; 
        hissFilter.frequency.value = 2800;
        const hissGain = ctx.createGain(); 
        hissGain.gain.value = 0.025;
        noise.connect(hissFilter); 
        hissFilter.connect(hissGain); 
        hissGain.connect(master);
        
        // Mid-range air/room tone
        const airFilter = ctx.createBiquadFilter(); 
        airFilter.type = 'bandpass'; 
        airFilter.frequency.value = 800; 
        airFilter.Q.value = 0.5;
        const airGain = ctx.createGain(); 
        airGain.gain.value = 0.018;
        noise.connect(airFilter); 
        airFilter.connect(airGain); 
        airGain.connect(master);
        
        // === VENTILATION FAN (greenhouse HVAC) ===
        const fanFilter = ctx.createBiquadFilter(); 
        fanFilter.type = 'bandpass'; 
        fanFilter.frequency.value = 220; 
        fanFilter.Q.value = 1.2;
        const fanLP = ctx.createBiquadFilter(); 
        fanLP.type = 'lowpass'; 
        fanLP.frequency.value = 1200;
        const fanGain = ctx.createGain(); 
        fanGain.gain.value = 0.022;
        
        // Add slow modulation to fan (blades passing)
        const fanLFO = ctx.createOscillator(); 
        fanLFO.frequency.value = 0.31;
        const fanLFOg = ctx.createGain(); 
        fanLFOg.gain.value = 0.008;
        fanLFO.connect(fanLFOg); 
        fanLFOg.connect(fanGain.gain);
        
        noise.connect(fanFilter); 
        fanFilter.connect(fanLP); 
        fanLP.connect(fanGain); 
        fanGain.connect(master);
        
        // Start all oscillators
        hum60.start(); 
        hum120.start(); 
        hum180.start(); 
        lfo1.start(); 
        lfo2.start(); 
        fanLFO.start();
        noise.start();
        
        audio.started = true;
      }
      
      function audioFade(to, sec){ 
        if(!audio.ctx || !audio.master) return; 
        const now = audio.ctx.currentTime; 
        const g = audio.master.gain; 
        g.setValueAtTime(g.value, now); 
        g.linearRampToValueAtTime(Math.max(0.0001, to), now + sec); 
      }

      // === HARD DRIVE SOUNDS (Mechanical 90s HDD) ===
      
      function playHddSeek(){ 
        if(!audio.ctx || !audio.noise) return; 
        const ctx = audio.ctx; 
        const now = ctx.currentTime;
        
        // Actuator arm movement (sweeping resonance)
        const armSweep = ctx.createBiquadFilter(); 
        armSweep.type = 'bandpass'; 
        armSweep.Q.value = 3.5;
        const sweepStart = 600 + Math.random() * 400;
        const sweepEnd = sweepStart + (Math.random() < 0.5 ? 1 : -1) * (400 + Math.random() * 600);
        armSweep.frequency.setValueAtTime(sweepStart, now);
        armSweep.frequency.exponentialRampToValueAtTime(sweepEnd, now + 0.15);
        
        const sweepGain = ctx.createGain();
        sweepGain.gain.setValueAtTime(0.0, now);
        sweepGain.gain.linearRampToValueAtTime(0.04, now + 0.02);
        sweepGain.gain.exponentialRampToValueAtTime(0.001, now + 0.18);
        
        audio.noise.connect(armSweep); 
        armSweep.connect(sweepGain); 
        sweepGain.connect(audio.master);
        
        // Head clicks (rapid ticking as it settles)
        const clicks = 4 + Math.floor(Math.random() * 6);
        let clickTime = 0.08;
        for(let i = 0; i < clicks; i++){
          const clickDelay = clickTime;
          clickTime += 0.012 + Math.random() * 0.018;
          
          setTimeout(() => {
            const t = ctx.currentTime;
            const clickBP = ctx.createBiquadFilter();
            clickBP.type = 'bandpass';
            clickBP.frequency.value = 700 + Math.random() * 600;
            clickBP.Q.value = 12;
            
            const clickGain = ctx.createGain();
            clickGain.gain.setValueAtTime(0.0, t);
            clickGain.gain.linearRampToValueAtTime(0.08 - (i * 0.008), t + 0.002);
            clickGain.gain.exponentialRampToValueAtTime(0.001, t + 0.035);
            
            audio.noise.connect(clickBP);
            clickBP.connect(clickGain);
            clickGain.connect(audio.master);
            
            setTimeout(() => {
              clickGain.disconnect();
              clickBP.disconnect();
            }, 100);
          }, clickDelay * 1000);
        }
        
        setTimeout(() => { 
          sweepGain.disconnect(); 
          armSweep.disconnect(); 
        }, 250);
      }
      
      function playHddGurgle(){ 
        if(!audio.ctx || !audio.noise) return; 
        const ctx = audio.ctx; 
        const now = ctx.currentTime;
        
        // Mid-frequency mechanical grinding/chatter (no low rumble!)
        const grindBP1 = ctx.createBiquadFilter();
        grindBP1.type = 'bandpass';
        grindBP1.frequency.setValueAtTime(280, now);
        grindBP1.frequency.linearRampToValueAtTime(320, now + 0.2);
        grindBP1.Q.value = 3.5;
        
        const grindGain1 = ctx.createGain();
        grindGain1.gain.setValueAtTime(0.0, now);
        grindGain1.gain.linearRampToValueAtTime(0.038, now + 0.03);
        grindGain1.gain.setValueAtTime(0.038, now + 0.25);
        grindGain1.gain.exponentialRampToValueAtTime(0.001, now + 0.35);
        
        audio.noise.connect(grindBP1);
        grindBP1.connect(grindGain1);
        grindGain1.connect(audio.master);
        
        // Higher frequency rattle overlay
        const grindBP2 = ctx.createBiquadFilter();
        grindBP2.type = 'bandpass';
        grindBP2.frequency.value = 480 + Math.random() * 200;
        grindBP2.Q.value = 4.0;
        
        const grindGain2 = ctx.createGain();
        grindGain2.gain.setValueAtTime(0.0, now);
        grindGain2.gain.linearRampToValueAtTime(0.028, now + 0.04);
        grindGain2.gain.setValueAtTime(0.028, now + 0.22);
        grindGain2.gain.exponentialRampToValueAtTime(0.001, now + 0.32);
        
        audio.noise.connect(grindBP2);
        grindBP2.connect(grindGain2);
        grindGain2.connect(audio.master);
        
        setTimeout(() => {
          grindGain1.disconnect();
          grindBP1.disconnect();
          grindGain2.disconnect();
          grindBP2.disconnect();
        }, 400);
      }
      
      function playHddThunk(){ 
        if(!audio.ctx || !audio.noise) return; 
        const ctx = audio.ctx; 
        const now = ctx.currentTime;
        
        // Park/unpark head thunk (mechanical impact)
        const thunkTone = ctx.createOscillator();
        thunkTone.type = 'sine';
        thunkTone.frequency.setValueAtTime(180 + Math.random() * 80, now);
        thunkTone.frequency.exponentialRampToValueAtTime(110, now + 0.08);
        
        const thunkToneGain = ctx.createGain();
        thunkToneGain.gain.setValueAtTime(0.0, now);
        thunkToneGain.gain.linearRampToValueAtTime(0.12, now + 0.004);
        thunkToneGain.gain.exponentialRampToValueAtTime(0.001, now + 0.12);
        
        thunkTone.connect(thunkToneGain);
        thunkToneGain.connect(audio.master);
        
        // Impact noise burst
        const impactHP = ctx.createBiquadFilter();
        impactHP.type = 'highpass';
        impactHP.frequency.value = 400;
        
        const impactLP = ctx.createBiquadFilter();
        impactLP.type = 'lowpass';
        impactLP.frequency.value = 2200;
        
        const impactGain = ctx.createGain();
        impactGain.gain.setValueAtTime(0.0, now);
        impactGain.gain.linearRampToValueAtTime(0.09, now + 0.003);
        impactGain.gain.exponentialRampToValueAtTime(0.001, now + 0.07);
        
        audio.noise.connect(impactHP);
        impactHP.connect(impactLP);
        impactLP.connect(impactGain);
        impactGain.connect(audio.master);
        
        thunkTone.start();
        
        setTimeout(() => {
          try { thunkTone.stop(); } catch {}
          thunkToneGain.disconnect();
          impactGain.disconnect();
          impactLP.disconnect();
          impactHP.disconnect();
        }, 180);
      }
      
      function scheduleHdd(){ 
        clearHdd();
        function scheduleNext(){
          const gap = 6000 + Math.random() * 18000; // 6-24s between accesses
          audio.hddTimer = setTimeout(() => {
            const r = Math.random();
            if(r < 0.55){ 
              playHddSeek(); 
            } else if(r < 0.85){ 
              playHddGurgle(); 
            } else { 
              playHddThunk(); 
            }
            
            // Occasional burst of activity (multiple operations)
            if(Math.random() < 0.2){ 
              setTimeout(() => playHddSeek(), 300 + Math.random() * 500);
              if(Math.random() < 0.4){
                setTimeout(() => playHddGurgle(), 800 + Math.random() * 700);
              }
            }
            
            scheduleNext();
          }, gap);
        }
        scheduleNext();
      }
      
      function clearHdd(){ 
        if(audio.hddTimer){ 
          clearTimeout(audio.hddTimer); 
          audio.hddTimer = null; 
        } 
      }
      
      // === GREENHOUSE AMBIENCE SOUNDS ===
      function playWaterDrip(){ 
        if(!audio.ctx) return; 
        const ctx = audio.ctx; 
        const now = ctx.currentTime;
        // Resonant water drop sound
        const osc = ctx.createOscillator(); 
        osc.type = 'sine'; 
        osc.frequency.setValueAtTime(800 + Math.random()*400, now);
        const g = ctx.createGain(); 
        g.gain.setValueAtTime(0.0, now);
        osc.connect(g); 
        g.connect(audio.master);
        g.gain.linearRampToValueAtTime(0.08, now + 0.005);
        g.gain.exponentialRampToValueAtTime(0.001, now + 0.18);
        osc.frequency.exponentialRampToValueAtTime(150, now + 0.15);
        osc.start(); 
        setTimeout(()=>{ try{osc.stop();}catch{} g.disconnect(); }, 250);
      }
      
      function playServoMotor(){ 
        if(!audio.ctx || !audio.noise) return; 
        const ctx = audio.ctx; 
        const now = ctx.currentTime;
        // Servo adjustment sound (vent motor)
        const bp = ctx.createBiquadFilter(); 
        bp.type = 'bandpass'; 
        bp.frequency.value = 380 + Math.random()*200; 
        bp.Q.value = 3.0;
        const g = ctx.createGain(); 
        g.gain.setValueAtTime(0.0, now);
        audio.noise.connect(bp); 
        bp.connect(g); 
        g.connect(audio.master);
        g.gain.linearRampToValueAtTime(0.025, now + 0.04);
        g.gain.setValueAtTime(0.025, now + 0.15 + Math.random()*0.2);
        g.gain.exponentialRampToValueAtTime(0.001, now + 0.45);
        setTimeout(()=>{ g.disconnect(); bp.disconnect(); }, 500);
      }
      
      function playMistingSystem(){ 
        if(!audio.ctx || !audio.noise) return; 
        const ctx = audio.ctx; 
        const now = ctx.currentTime;
        // Pressurized misting sound
        const hp = ctx.createBiquadFilter(); 
        hp.type = 'highpass'; 
        hp.frequency.value = 3500;
        const lp = ctx.createBiquadFilter(); 
        lp.type = 'lowpass'; 
        lp.frequency.value = 8000;
        const g = ctx.createGain(); 
        g.gain.setValueAtTime(0.0, now);
        audio.noise.connect(hp); 
        hp.connect(lp); 
        lp.connect(g); 
        g.connect(audio.master);
        g.gain.linearRampToValueAtTime(0.035, now + 0.08);
        g.gain.setValueAtTime(0.035, now + 1.2);
        g.gain.exponentialRampToValueAtTime(0.001, now + 1.6);
        setTimeout(()=>{ g.disconnect(); lp.disconnect(); hp.disconnect(); }, 1700);
      }
      
      function scheduleGreenhouseAmbience(){ 
        if(audio.ambienceTimer) clearTimeout(audio.ambienceTimer);
        function scheduleNext(){
          const gap = 15000 + Math.random()*30000; // 15-45s between events
          audio.ambienceTimer = setTimeout(()=>{
            const r = Math.random();
            if(r < 0.5){ 
              // Single or double water drip
              playWaterDrip(); 
              if(Math.random() < 0.3){ 
                setTimeout(()=> playWaterDrip(), 150 + Math.random()*300); 
              }
            } else if(r < 0.85){ 
              playServoMotor(); 
            } else { 
              playMistingSystem(); 
            }
            scheduleNext();
          }, gap);
        }
        scheduleNext();
      }
      
      function clearGreenhouseAmbience(){ 
        if(audio.ambienceTimer){ 
          clearTimeout(audio.ambienceTimer); 
          audio.ambienceTimer = null; 
        } 
      }

      function playClick(){ if(!audio.ctx) return; const ctx=audio.ctx; const now=ctx.currentTime; const src = ctx.createBufferSource(); const buf = ctx.createBuffer(1, 128, ctx.sampleRate); const d=buf.getChannelData(0); for(let i=0;i<d.length;i++){ d[i] = (Math.random()*2-1) * Math.exp(-i/32); } src.buffer=buf; const hp=ctx.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=1200; const g=ctx.createGain(); g.gain.value=0.0; src.connect(hp); hp.connect(g); g.connect(audio.master); src.start(); g.gain.linearRampToValueAtTime(0.28, now+0.01); g.gain.exponentialRampToValueAtTime(0.0008, now+0.08); setTimeout(()=>{ g.disconnect(); hp.disconnect(); }, 200); }
      function playDegauss(){ if(!audio.ctx) return; const ctx=audio.ctx; const now=ctx.currentTime;
        const osc = ctx.createOscillator(); osc.type='sine'; osc.frequency.setValueAtTime(95, now); osc.frequency.exponentialRampToValueAtTime(42, now+0.45);
        const lpg = ctx.createGain(); lpg.gain.setValueAtTime(0.0, now); lpg.gain.linearRampToValueAtTime(0.55, now+0.08); lpg.gain.exponentialRampToValueAtTime(0.001, now+0.7);
        const nsrc = ctx.createBufferSource(); nsrc.buffer = audio.noise.buffer; nsrc.loop=true; const nlp = ctx.createBiquadFilter(); nlp.type='lowpass'; nlp.frequency.setValueAtTime(1800, now); nlp.frequency.exponentialRampToValueAtTime(600, now+0.4); const ngg = ctx.createGain(); ngg.gain.setValueAtTime(0.0, now); ngg.gain.linearRampToValueAtTime(0.22, now+0.06); ngg.gain.exponentialRampToValueAtTime(0.001, now+0.6);
        osc.connect(lpg); lpg.connect(audio.master);
        nsrc.connect(nlp); nlp.connect(ngg); ngg.connect(audio.master);
        osc.start(); nsrc.start();
        setTimeout(()=>{ try{osc.stop();}catch{} try{nsrc.stop();}catch{} lpg.disconnect(); ngg.disconnect(); nlp.disconnect(); }, 900);
      }

      // UI test beep (loud and short)
      function playUiBeep(vol=0.4, freq=1000, dur=0.14){ if(!audio.ctx) return; const ctx=audio.ctx; const now=ctx.currentTime;
        const osc = ctx.createOscillator(); osc.type='square'; osc.frequency.setValueAtTime(freq, now);
        const g = ctx.createGain(); g.gain.setValueAtTime(0.0001, now);
        osc.connect(g); g.connect(audio.master);
        // quick attack and release
        g.gain.exponentialRampToValueAtTime(vol, now + 0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, now + dur);
        osc.start(); setTimeout(()=>{ try{osc.stop();}catch{} g.disconnect(); }, Math.ceil((dur+0.05)*1000));
      }
      async function uiDblClick(){ if(!AudioCtx) return; if(!audio.started) initAudio(); if(audio.ctx.state==='suspended') try{ await audio.ctx.resume(); }catch(e){}
        // single loud beep for testing
        playUiBeep(0.4, 1000, 0.16);
      }

      async function audioOn(){ if(!AudioCtx) return; if(!audio.started) initAudio(); if(audio.ctx.state==='suspended') await audio.ctx.resume();
        audioFade(0.22, 0.6);
        scheduleHdd();
        scheduleGreenhouseAmbience();
      }
      async function audioOff(){ 
        if(!audio.ctx) return; 
        clearHdd(); 
        clearGreenhouseAmbience(); 
        playPowerOffClick(); 
        playDegauss(); 
        audioFade(0.0001, 0.35); 
        setTimeout(()=>{ 
          audio.ctx.state !== 'suspended' && audio.ctx.suspend?.(); 
        }, 1000); 
      }

      // Power button behavior with animations
      function powerOff(){
        if(monitor.classList.contains('off')) return;
        
        // Button press effect
        if(powerBtn){
          powerBtn.style.transform = 'translateY(2px)';
          setTimeout(() => { powerBtn.style.transform = ''; }, 120);
        }
        
        screenEl.classList.remove('on-anim');
        screenEl.classList.add('off-anim');
        const done=()=>{ 
          monitor.classList.add('off'); 
          screenEl.classList.remove('off-anim'); 
          screenEl.removeEventListener('animationend', done); 
        };
        screenEl.addEventListener('animationend', done);
        startMenu.classList.remove('open');
        powerBtn.setAttribute('aria-pressed','false');
        audioOff();
        
        // show hint after powering off
        powerHint.style.display = '';
        monitor.classList.remove('booting');
      }
      
      function powerOn(){
        if(!monitor.classList.contains('off')) return;
        
        // Button press effect
        if(powerBtn){
          powerBtn.style.transform = 'translateY(2px)';
          setTimeout(() => { powerBtn.style.transform = ''; }, 120);
        }
        
        monitor.classList.remove('off');
        screenEl.classList.remove('off-anim');
        screenEl.classList.add('on-anim');
        const done=()=>{ 
          screenEl.classList.remove('on-anim'); 
          screenEl.removeEventListener('animationend', done); 
        };
        screenEl.addEventListener('animationend', done);
        powerBtn.setAttribute('aria-pressed','true');
        audioOn();
        
        // Multi-stage power-on sequence
        playPowerOnWhine();
        
        // hide hint and run boot sequence first time
        powerHint.style.display = 'none';
        if(!window.__bootDone){ runBootSequence(); }
      }
      
      powerBtn?.addEventListener('click', async ()=>{
        if(!audio.started) initAudio();
        if(audio.ctx && audio.ctx.state==='suspended') { 
          try{ await audio.ctx.resume(); }catch(e){} 
        }
        
        // Tactile click feedback
        playClick();
        
        if(monitor.classList.contains('off')) powerOn(); 
        else powerOff();
      });

      // Boot sequence typing
      function runBootSequence(){
        window.__bootDone = true;
        // create overlay
        let boot = document.getElementById('boot');
        if(!boot){ boot = document.createElement('div'); boot.id='boot'; boot.className='boot show'; boot.innerHTML = '<pre id="bootText"></pre>'; desktop.parentElement.appendChild(boot); }
        const out = boot.querySelector('#bootText');
        monitor.classList.add('booting');
        monitor.classList.add('vector-hide');
        const lines = [
          'Phosphor-95 BIOS (C) 1995 Retrotronics Inc.\n',
          'Memory Test: ██████████████████████████  65536K OK\n',
          'Detecting IDE devices...\n',
          '  Primary Master: PH-095 SSD 512MB\n',
          '  Primary Slave : N/A\n',
          'Booting from C:\\...\n\n',
          '       ▄███████▄    ▄█    █▄     ▄██████▄     ▄████████    ▄███████▄    ▄█    █▄     ▄██████▄     ▄████████ \n',
          '      ███    ███   ███    ███   ███    ███   ███    ███   ███    ███   ███    ███   ███    ███   ███    ███ \n',
          '      ███    ███   ███    ███   ███    ███   ███    █▀    ███    ███   ███    ███   ███    ███   ███    ███ \n',
          '      ███    ███  ▄███▄▄▄▄███▄▄ ███    ███   ███          ███    ███  ▄███▄▄▄▄███▄▄ ███    ███  ▄███▄▄▄▄██▀ \n',
          '    ▀█████████▀  ▀▀███▀▀▀▀███▀  ███    ███ ▀███████████ ▀█████████▀  ▀▀███▀▀▀▀███▀  ███    ███ ▀▀███▀▀▀▀▀   \n',
          '      ███          ███    ███   ███    ███          ███   ███          ███    ███   ███    ███ ▀███████████ \n',
          '      ███          ███    ███   ███    ███    ▄█    ███   ███          ███    ███   ███    ███   ███    ███ \n',
          '     ▄████▀        ███    █▀     ▀██████▀   ▄████████▀   ▄████▀        ███    █▀     ▀██████▀    ███    ███ \n',
          '                                                                                                 ███    ███ \n',
          '\n                             Sr. Vibe Engineer: Mason Sale - VIBEJAM #2 MMXXV\n',
          '\nInitializing system...\n',
        ];
        const full = lines.join('');
        // Calculate ASCII logo position range
        const logoStart = lines.slice(0, 6).join('').length;
        const logoEnd = lines.slice(0, 15).join('').length;
        let i=0; out.textContent='';
        const type = ()=>{
          const chunk = full.slice(i, i+ Math.max(1, Math.floor(Math.random()*4)+1));
          i += chunk.length; out.textContent += chunk;
          // Speed up during ASCII logo section
          const inLogo = i >= logoStart && i < logoEnd;
          const delay = inLogo ? (2 + Math.random()*4) : (12 + Math.random()*28);
          if(i < full.length){ setTimeout(type, delay); }
          else {
            // show blinking cursor briefly then fade
            const cursor = document.createElement('span'); cursor.className='cursor'; cursor.textContent=' ';
            out.appendChild(cursor);
            setTimeout(()=>{ boot.classList.remove('show'); boot.style.transition='opacity .35s ease'; boot.style.opacity='0'; setTimeout(()=> { boot.remove(); monitor.classList.remove('booting'); startVectorDraw(); }, 380); }, 650);
          }
        };
        type();
      }

      function startVectorDraw(){
        monitor.classList.remove('vector-hide');
        const reveal = (sel, delay)=> setTimeout(()=>{
          document.querySelectorAll(sel).forEach(el=>{ el.classList.add('line-draw'); el.style.opacity='1'; });
        }, delay);
        reveal('.desktop', 0);
        reveal('.taskbar', 120);
        reveal('.start, .tasks .task', 220);
        reveal('.win', 320);
      }

      // === DEBUG: Download all web resources (Alt+W) ===
      document.addEventListener('keydown', async (e) => {
        if(e.altKey && e.key === 'w'){
          e.preventDefault();
          console.log('Starting resource download...');
          
          try {
            // Load JSZip dynamically
            if(!window.JSZip){
              const script = document.createElement('script');
              script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js';
              document.head.appendChild(script);
              await new Promise((resolve, reject) => {
                script.onload = resolve;
                script.onerror = reject;
              });
            }

            const zip = new JSZip();
            
            // Collect all unique image URLs from photo log
            const imageUrls = [
              'https://cdn.midjourney.com/f1a3498b-691c-43e7-bd29-7239fe3a7a0b/0_1.png',
              'https://cdn.midjourney.com/f1a3498b-691c-43e7-bd29-7239fe3a7a0b/0_0.png',
              'https://cdn.midjourney.com/73040fd8-3256-42fd-b784-f89f81813230/0_1.png',
              'https://cdn.midjourney.com/73040fd8-3256-42fd-b784-f89f81813230/0_0.png',
              'https://cdn.midjourney.com/73040fd8-3256-42fd-b784-f89f81813230/0_2.png',
              'https://cdn.midjourney.com/73040fd8-3256-42fd-b784-f89f81813230/0_3.png',
              'https://cdn.midjourney.com/aa9f127e-ecd2-41a6-9f98-73b69ad9f816/0_2.png',
              'https://cdn.midjourney.com/aa9f127e-ecd2-41a6-9f98-73b69ad9f816/0_0.png',
              'https://cdn.midjourney.com/947f2b72-4664-449f-bd85-a65fbcd7ae76/0_0.png',
              'https://cdn.midjourney.com/947f2b72-4664-449f-bd85-a65fbcd7ae76/0_2.png',
              'https://cdn.midjourney.com/947f2b72-4664-449f-bd85-a65fbcd7ae76/0_1.png',
              'https://cdn.midjourney.com/b25a1ab5-16ad-4bdd-b496-2a1e2e1ef311/0_3.png',
              'https://cdn.midjourney.com/ab6e63db-2b87-4f3e-b275-85c9041c9ae9/0_0.png',
              'https://cdn.midjourney.com/ab6e63db-2b87-4f3e-b275-85c9041c9ae9/0_2.png',
              'https://cdn.midjourney.com/f24ebf8c-00a4-4ac9-b0c2-a3315d35081f/0_3.png',
              'https://cdn.midjourney.com/e37b3157-5aba-4c60-8a41-2dab49f7be6f/0_2.png',
              'https://cdn.midjourney.com/ee2339b9-9c69-4ace-9cdd-9c6a14853d89/0_1.png',
              'https://cdn.midjourney.com/d0ba5de8-c824-4c7d-8479-33e15a2cf518/0_2.png',
              'https://cdn.midjourney.com/d0ba5de8-c824-4c7d-8479-33e15a2cf518/0_1.png',
              'https://cdn.midjourney.com/d0ba5de8-c824-4c7d-8479-33e15a2cf518/0_3.png',
              'https://cdn.midjourney.com/d0ba5de8-c824-4c7d-8479-33e15a2cf518/0_0.png',
              'https://cdn.midjourney.com/f2a69596-e20d-401f-a17b-753f3ec44761/0_2.png'
            ];

            // Video URL
            const videoUrl = 'https://cdn.midjourney.com/video/9fc8691f-14b0-496d-a9c9-21206c3f52e0/2.mp4';

            // Download images
            console.log(`Downloading ${imageUrls.length} images...`);
            for(let i = 0; i < imageUrls.length; i++){
              const url = imageUrls[i];
              const filename = url.split('/').slice(-2).join('_');
              try {
                const response = await fetch(url);
                const blob = await response.blob();
                zip.file(`images/${filename}`, blob);
                console.log(`Downloaded ${i+1}/${imageUrls.length}: ${filename}`);
              } catch(err) {
                console.error(`Failed to download ${url}:`, err);
              }
            }

            // Download video
            console.log('Downloading video...');
            try {
              const response = await fetch(videoUrl);
              const blob = await response.blob();
              zip.file('video/reflection.mp4', blob);
              console.log('Video downloaded');
            } catch(err) {
              console.error('Failed to download video:', err);
            }

            // Download Indie Flower font
            console.log('Downloading font...');
            try {
              // Get the font CSS
              const fontCssResponse = await fetch('https://fonts.googleapis.com/css2?family=Indie+Flower&display=swap');
              const fontCss = await fontCssResponse.text();
              
              // Extract font URL from CSS
              const fontUrlMatch = fontCss.match(/url\((https:\/\/[^)]+)\)/);
              if(fontUrlMatch){
                const fontUrl = fontUrlMatch[1];
                const fontResponse = await fetch(fontUrl);
                const fontBlob = await fontResponse.blob();
                zip.file('fonts/IndieFlower.woff2', fontBlob);
                // Also save the CSS
                zip.file('fonts/IndieFlower.css', fontCss);
                console.log('Font downloaded');
              }
            } catch(err) {
              console.error('Failed to download font:', err);
            }

            // Create README
            const readme = `PHOSPHOR GARDENS - Web Resources
================================

This archive contains all external web resources used in the project:

/images/ - All plant photos from Midjourney
/video/  - CRT reflection video
/fonts/  - Indie Flower font (Google Fonts)

Downloaded: ${new Date().toISOString()}

To use offline:
1. Place these files in appropriate local directories
2. Update the URLs in index.html to point to local files

Image URLs: ${imageUrls.length} files
Video: 1 file
Font: IndieFlower from Google Fonts
`;
            zip.file('README.txt', readme);

            // Generate and download zip
            console.log('Generating zip file...');
            const content = await zip.generateAsync({type: 'blob'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(content);
            link.download = `phosphor-gardens-resources-${Date.now()}.zip`;
            link.click();
            
            console.log('Download complete!');
            
            // Show notification
            const notification = document.createElement('div');
            notification.style.cssText = 'position:fixed;top:20px;right:20px;background:#7aff7a;color:#000;padding:16px 24px;border-radius:4px;box-shadow:0 4px 12px rgba(0,0,0,0.3);z-index:99999;font-family:monospace;';
            notification.textContent = '✓ Resources downloaded!';
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
            
          } catch(error) {
            console.error('Error downloading resources:', error);
            alert('Failed to download resources. Check console for details.');
          }
        }
      });
    })();
  </script>
</body>
</html>
